!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t){e.exports='<div id="div-contenedor" class="m-control m-container m-ignsearch" title="">\n    <div class="search-panel">\n        <input type="text" id="m-ignsearch-search-input" class="m-input-search" placeholder="Dirección, topónimo o Ref. catastral (14 dig.)" />\n        <button id="m-ignsearch-locate-button" title="Obtener dirección en un punto del mapa"><span class="g-cartografia-localizacion3"></span></button>\n        <button id="m-ignsearch-clear-button" class="m-button-limpiar" title="Borrar resultados de la búsqueda"><span class="g-cartografia-papelera"></span></button>\n    </div>\n    <div id="m-ignsearch-results">\n        \x3c!-- Here goes the list of search results --\x3e\n    </div>\n</div>'},function(e,t){e.exports='<ul id="m-ignsearch-results-list">\n    {{#each places}}\n        {{#if this.address}}\n            {{#printType this.type this.address this.id this.municipality}}\n            {{/printType}}\n        {{else}}\n            {{#printType this.type this.title this.id this.municipality}}\n            {{/printType}}\n        {{/if}}\n    {{/each}}\n</ul>'},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(2);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e,t,n){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l,u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,s(t).apply(this,arguments))}var n,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(t,M.impl.Control),n=t,(r=[{key:"addTo",value:function(e,n){a(s(t.prototype),"addTo",this).call(this,e,n)}},{key:"setScale",value:function(e){var t=e/(M.units.DOTS_PER_INCH/2.54)/100;this.facadeMap_.getMapImpl().getView().setResolution(t)}},{key:"reproject",value:function(e,t,n){return ol.proj.getTransform(t,n)(e)}}])&&o(n.prototype,r),l&&o(n,l),t}(),p=n(0),d=n.n(p),f=n(1),h=n.n(f),y=function(){Handlebars.registerHelper("toUpperCase",function(e){return e.toUpperCase()}),Handlebars.registerHelper("ifCond",function(e,t,n,r){switch(t){case"===":return e===n?r.fn(void 0):r.inverse(void 0);case"!==":return e!==n?r.fn(void 0):r.inverse(void 0);case"<":return e<n?r.fn(void 0):r.inverse(void 0);case"<=":return e<=n?r.fn(void 0):r.inverse(void 0);case">":return e>n?r.fn(void 0):r.inverse(void 0);case">=":return e>=n?r.fn(void 0):r.inverse(void 0);case"&&":return e&&n?r.fn(void 0):r.inverse(void 0);case"||":return e||n?r.fn(void 0):r.inverse(void 0);default:return r.inverse(void 0)}}),Handlebars.registerHelper("printType",function(e,t,n,r){var o="<li id=".concat(n,"> ").concat(t.toUpperCase());return void 0!==r&&(o+=" en ".concat(r)),o})},v=["Estado","Comunidad autónoma","Ciudad con estatuto de autonomía","Provincia","Municipio","poblacion","EATIM","Isla administrativa","Comarca administrativa","Jurisdicción","Capital de municipio","Capital de EATIM","Núcleos de población","Entidad colectiva","Entidad menor de población","Distrito municipal","Entidad singular","Construcción/instalación abierta","Edificación","Vértice Geodésico","Hitos de demarcación territorial","Hitos en vías de comunicación","Alineación montañosa","Montaña","Paso de montaña","Llanura","Depresión","Vertientes","Comarca geográfica","Paraje","Elemento puntual del paisaje","Saliente costero","Playa","Isla","Otro relieve costero","Parque Nacional y Natural","Espacio protegido restante","Aeropuerto","Aeródromo","Pista de aviación y helipuerto","Puerto de Estado","Instalación portuaria","Camino y vía pecuaria","Ferrocarril","Curso natural de agua","Masa de agua","Curso artificial de agua","Embalse","Hidrónimo puntual","Glaciares","Mar","Entrante costero y estrecho marítimo","Relieve submarino"];function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var P=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"gn",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"municipio,poblacion",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"es",a=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,p=arguments.length>8?arguments[8]:void 0,d=arguments.length>9?arguments[9]:void 0,f=!(arguments.length>10&&void 0!==arguments[10])||arguments[10],h=arguments.length>11?arguments[11]:void 0,m=arguments.length>12&&void 0!==arguments[12]?arguments[12]:v;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(u)&&M.exception("La implementación usada no puede crear controles IGNSearchControl");var g=new u;return(e=b(this,w(t).call(this,g,"IGNSearch"))).servicesToSearch=n,e.maxResults=r,e.noProcess=o,e.countryCode=i,e.urlCandidates=a,e.urlFind=s,e.urlReverse=c,e.urlPrefix=l,e.urlAssistant=p,e.urlDispatcher=d,e.resultVisibility_=f,e.nomenclatorSearchType=m,e.reverse=h,e.reverseActivated=!1,y(),e}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(t,M.Control),n=t,(r=[{key:"createView",value:function(e){var t=this;return this.map=e,new Promise(function(e){var n=M.template.compileSync(d.a);t.html=n,t.resultsBox=n.querySelector("#m-ignsearch-results"),t.searchInput=t.html.querySelector("#m-ignsearch-search-input"),n.querySelector("#m-ignsearch-clear-button").addEventListener("click",t.clearResultsAndGeometry.bind(t)),n.querySelector("#m-ignsearch-search-input").addEventListener("keyup",function(e){return t.createTimeout(e)}),n.querySelector("#m-ignsearch-search-input").addEventListener("keydown",function(){clearTimeout(l)}),n.querySelector("#m-ignsearch-locate-button").addEventListener("click",t.activateDeactivateReverse.bind(t)),document.querySelector(".ign-search-panel>.m-panel-btn").addEventListener("click",t.clearResults.bind(t)),t.clickReverseEvent=t.map.on(M.evt.CLICK,function(e){return t.showReverseTooltip(e)}),t.changePlaceholder(),t.reverse||(n.querySelector("#m-ignsearch-locate-button").style.display="none"),e(n)})}},{key:"activateDeactivateReverse",value:function(){this.reverseActivated?(this.reverseActivated=!1,document.querySelector("#m-ignsearch-locate-button span").style.color="#7A7A73"):(this.reverseActivated=!0,document.querySelector("#m-ignsearch-locate-button span").style.color="#71a7d3")}},{key:"showReverseTooltip",value:function(e){var t=this;if(this.reverseActivated){var n=this.map.getProjection().code,r=this.getImpl().reproject([e.coord[0],e.coord[1]],n,"EPSG:4258"),o="lon=".concat(r[0],"&lat=").concat(r[1]),i="".concat(this.urlReverse,"?").concat(o);M.remote.get(i).then(function(n){if(null!==n.text){var o=JSON.parse(n.text),i=t.createFullAddress(o),a=e.coord,s=[r[1],r[0]];t.showPopUp(i,a,s)}})}}},{key:"createTimeout",value:function(e){var t=this;clearTimeout(l),l=setTimeout(function(){return t.searchInputValue(e)},500)}},{key:"getActivationButton",value:function(e){return e.querySelector(".m-ignsearch button")}},{key:"equals",value:function(e){return e instanceof t}},{key:"searchInputValue",value:function(e){var t=this,n=e.target.value;if(n.length<=2)this.resultsBox.innerHTML="";else{this.resultsBox.innerHTML="",this.resultsBox.classList.add("g-cartografia-spinner"),this.resultsBox.style.fontSize="24px",this.allCandidates=[];/[+-]?\d+\.\d+(\s|,|(,\s))[+-]?\d+\.\d+/.test(n)?this.searchCoordinates(n):this.getNomenclatorData(n,this.allCandidates).then(function(){t.getCandidatesData(n,t.allCandidates).then(function(){t.resultsBox.innerHTML="";var e=M.template.compileSync(h.a,{vars:{places:t.allCandidates}});e.querySelectorAll("li").forEach(function(e){e.addEventListener("click",function(){t.goToLocation(e)})}),t.resultsBox.classList.remove("g-cartografia-spinner"),t.resultsBox.style.fontSize="1em",t.resultsBox.appendChild(e)})})}}},{key:"drawGeocoderResult",value:function(e){this.map.removeLayers(this.clickedElementLayer);var t=JSON.parse(e);if(t.geometry.coordinates=this.fixCoordinatesPath(t),this.coordinates="".concat(t.properties.lat,", ").concat(t.properties.lng),this.clickedElementLayer=new M.layer.GeoJSON({name:"Resultado búsquedas",source:{type:"FeatureCollection",features:[t]}}),this.clickedElementLayer.displayInLayerSwitcher=!1,this.resultVisibility_||this.clickedElementLayer.setStyle(this.simple),this.map.addLayers(this.clickedElementLayer),this.zoomInLocation("g",t.geometry.type),"callejero"===t.properties.type||"portal"===t.properties.type){var n=this.createFullAddress(t.properties),r=[t.properties.lat,t.properties.lng],o=t.properties.state;this.showSearchPopUp(n,r,o)}}},{key:"createFullAddress",value:function(e){var t=null===e.tip_via||void 0===e.tip_via?"":e.tip_via,n=null===e.address||void 0===e.address?"":e.address,r=null===e.portalNumber||void 0===e.portalNumber||0===e.portalNumber?"":e.portalNumber;return"".concat(t," ").concat(n," ").concat(r)}},{key:"drawNomenclatorResult",value:function(e){var t=this;M.remote.get(this.urlDispatcher,{request:"OpenQuerySource",query:'<ogc:Filter><ogc:FeatureId fid="'.concat(e,'"/></ogc:Filter>'),sourcename:"".concat(this.urlPrefix,"communicationsPoolServlet/sourceAccessWFS-INSPIRE-NGBE.rdf"),outputformat:"application/json"}).then(function(e){var n=JSON.parse(e.text).results[0].location,r=JSON.parse(e.text).results[0].title,o=n.split(" "),i=parseFloat(o[0]),a=parseFloat(o[1]);t.map.removeLayers(t.clickedElementLayer);var s={name:"Resultado búsquedas",source:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[a,i]},properties:{name:r}}]}};t.clickedElementLayer=new M.layer.GeoJSON(s),t.clickedElementLayer.displayInLayerSwitcher=!1,t.clickedElementLayer.setStyle(t.point),t.resultVisibility_||t.clickedElementLayer.setStyle(t.simple),t.map.addLayers(t.clickedElementLayer),t.zoomInLocation("n","Point")})}},{key:"getCandidatesData",value:function(e,t){var n=this,r=window.encodeURIComponent(e);return new Promise(function(e){if("n"!==n.servicesToSearch){var o="q=".concat(r,"&limit=").concat(n.maxResults,"&no_process=").concat(n.noProcess);o+="&countrycode=".concat(n.countryCode,"&autocancel='true'");var i="".concat(n.urlCandidates,"?").concat(o);M.remote.get(i).then(function(n){for(var r=JSON.parse(n.text.substring(9,n.text.length-1)),o=0;o<r.length;o+=1)t.push(r[o]);e()})}else e()})}},{key:"getNomenclatorData",value:function(e,t){var n=this,r=window.encodeURIComponent(e);return new Promise(function(e){if("g"!==n.servicesToSearch){var o="maxresults=".concat(n.maxResults,"&name_equals=").concat(r),i="".concat(n.urlAssistant,"?").concat(o);M.remote.get(i).then(function(r){for(var o=(""!==r.text?JSON.parse(r.text):{results:[]}).results,i=0;i<o.length;i+=1)n.nomenclatorSearchType.indexOf(o[i].type)>=0&&t.push(o[i]);for(var a=0;a<t.length;a+=1)if("Núcleos de población"===t[a].type){var s=t.splice(a,1);t.splice(0,0,s)}e()})}else e()})}},{key:"getFindData",value:function(e,t){var n=this;return new Promise(function(r){var o,i,a,s,c;if(t.forEach(function(t){e.getAttribute("id")===t.id&&(o="&id=".concat(t.id),i="&type=".concat(t.type),a=0!==t.portalNumber&&void 0!==t.portalNumber?"&portal=".concat(t.portalNumber):"",s=""!==t.tip_via?"&tip_via=".concat(t.tip_via):"")}),e.innerHTML.includes("(")){var l=e.innerHTML.indexOf("(");c=e.innerHTML.substring(0,l)}var u="".concat(i).concat(s).concat(o).concat(a,"&outputformat=geojson"),p="".concat(n.urlFind,"?q=").concat(c).concat(u);M.proxy(!1),M.remote.get(p).then(function(e){var t=e.text.substring(9,e.text.length-1);r(t)}),M.proxy(!0)})}},{key:"goToLocation",value:function(e){var t=this;this.currentElement=e;var n=this.findClickedItem(e,this.allCandidates);this.createGeometryStyles(),Object.prototype.hasOwnProperty.call(n,"address")?this.getFindData(e,this.allCandidates).then(function(e){t.drawGeocoderResult(e)}):this.drawNomenclatorResult(n.id)}},{key:"zoomInLocation",value:function(e,t){var n=this;this.resultsList=document.getElementById("m-ignsearch-results-list"),this.clickedElementLayer.calculateMaxExtent().then(function(r){n.map.setBbox(r),"n"!==e&&"Point"!==t||n.setScale(2e3),n.resultsList.innerHTML="",n.searchInput.value="",n.searchInput.value=n.currentElement.innerHTML,n.resultsList.appendChild(n.currentElement),n.fire("ignsearch:entityFound",[r])})}},{key:"findClickedItem",value:function(e,t){return t.filter(function(t){return t.id===e.getAttribute("id")})[0]}},{key:"fixCoordinatesPath",value:function(e){return"Point"===e.geometry.type?e.geometry.coordinates[0][0]:"LineString"===e.geometry.type?e.geometry.coordinates[0]:e.geometry.coordinates}},{key:"searchCoordinates",value:function(e){return new Promise(function(e){e()})}},{key:"clearResults",value:function(){this.searchInput.value="",this.resultsBox.innerHTML=""}},{key:"clearResultsAndGeometry",value:function(){this.clearResults(),void 0!==this.clickedElementLayer&&this.clickedElementLayer.setStyle(this.simple),this.map.removePopup(this.popup,[this.lng,this.lat])}},{key:"setResultVisibility",value:function(e){this.resultVisibility_=e}},{key:"changePlaceholder",value:function(){"g"===this.servicesToSearch?this.searchInput.placeholder="Dirección o Ref. catastral (14 díg.) ":"n"===this.servicesToSearch&&(this.searchInput.placeholder="Topónimo")}},{key:"createGeometryStyles",value:function(){this.point=new M.style.Point({radius:5,icon:{form:"none",class:"g-cartografia-pin",radius:12,rotation:0,rotate:!1,offset:[0,-12],color:"#f00",opacity:1}}),this.simple=new M.style.Polygon({fill:{color:"black",opacity:0}})}},{key:"showSearchPopUp",value:function(e,t,n){var r,o=this.map.getProjection().code,i=this.getImpl().reproject([t[1],t[0]],"EPSG:4326",o);r=1!==n?"Dirección aproximada":"Dirección exacta",this.showPopUp(e,i,t,r)}},{key:"showPopUp",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o={content:""};null!==r&&(o.content+="<div><b>".concat(r,"</b></div>")),o.content+="<div>".concat(e,"</div>\n                <div class='ignsearch-popup'>Lat: ").concat(n[0],"</div>\n                <div class='ignsearch-popup'> Long: ").concat(n[1]," </div>");var i=new M.Popup;i.addTab(o),this.map.addPopup(i,[t[0],t[1]]),this.popup=i,this.lat=t[1],this.lng=t[0]}},{key:"setScale",value:function(e){this.getImpl().setScale(e)}}])&&g(n.prototype,r),o&&g(n,o),t}();function C(e){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){return!t||"object"!==C(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var E=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=k(this,x(t).call(this))).map_=null,n.controls_=[],n.servicesToSearch=e.servicesToSearch||"gn",n.maxResults=e.maxResults||10,n.noProcess=e.noProcess||"municipio,poblacion",n.countryCode=e.countryCode||"es",n.urlCandidates=e.urlCandidates||"https://www.cartociudad.es/geocoder/api/geocoder/candidatesJsonp",n.urlFind=e.urlFind||"https://www.cartociudad.es/geocoder/api/geocoder/findJsonp",n.urlReverse=e.urlReverse||"https://www.cartociudad.es/geocoder/api/geocoder/reverseGeocode",n.urlPrefix=e.urlPrefix||"http://www.idee.es/",n.urlAssistant=e.urlAssistant||"https://www.idee.es/communicationsPoolServlet/SearchAssistant",n.urlDispatcher=e.urlDispatcher||"https://www.idee.es/communicationsPoolServlet/Dispatcher",n.nomenclatorSearchType=e.nomenclatorSearchType,n.resultVisibility=e.resultVisibility||!0,n.isCollapsed=e.isCollapsed||!1,n.position=e.position||"TL",n.tooltip_=e.tooltip||"Búsqueda de lugares",n.reverse_=e.reverse||!1,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,M.Plugin),n=t,(r=[{key:"addTo",value:function(e){var t=this;this.controls_.push(new P(this.servicesToSearch,this.maxResults,this.noProcess,this.countryCode,this.urlCandidates,this.urlFind,this.urlReverse,this.urlPrefix,this.urlAssistant,this.urlDispatcher,this.resultVisibility,this.reverse_)),this.controls_[0].on("ignsearch:entityFound",function(e){t.fire("ignsearch:entityFound",[e])}),this.map_=e,this.panel_=new M.ui.Panel("panelIGNSearch",{collapsible:!0,position:M.ui.position[this.position],collapsed:this.isCollapsed,className:"ign-search-panel",tooltip:this.tooltip_}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_)}},{key:"setResultVisibility",value:function(e){this.controls_[0].setResultVisibility(e)}}])&&_(n.prototype,r),o&&_(n,o),t}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.IGNSearch=E,window.M.control.IGNSearchControl=P,window.M.impl.control.IGNSearchControl=u}]);
//# sourceMappingURL=ignsearch.ol.min.js.map