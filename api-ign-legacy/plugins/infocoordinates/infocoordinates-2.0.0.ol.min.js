(()=>{var t={843:t=>{t.exports='<div class="m-control m-container m-infocatastro-container">\n    <button id=\'m-infocatastro-btn\' class="m-infocatastro-btn icon-posicion4" title="{{translations.consultar}}"></button>\n</div>'}},e={};function o(n){var r=e[n];if(void 0!==r)return r.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,o),a.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,n(r.key),r)}}function n(e){var o=function(e,o){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,o||"default");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===o?String:Number)(e)}(e,"string");return"symbol"==t(o)?o:o+""}function r(e,o,n){return o=c(o),function(e,o){if(o&&("object"==t(o)||"function"==typeof o))return o;if(void 0!==o)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(e)}(e,a()?Reflect.construct(o,n||[],c(e).constructor):o.apply(e,n))}function a(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(a=function(){return!!t})()}function i(){return i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,o){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:o):r.value}},i.apply(null,arguments)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function s(t,e){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},s(t,e)}var l=function(t){function o(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),r(this,o,arguments)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(o,M.impl.Control),n=o,(a=[{key:"addTo",value:function(t,e){i(c(o.prototype),"addTo",this).call(this,t,e)}}])&&e(n.prototype,a),l&&e(n,l),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,a,l}(),u=o(843),f=o.n(u);const p=JSON.parse('{"tooltip":"Cadastre information","informacionCatastral":"Cadastre information","errorConexion":"It is not possible to establish a connection with the Cadastre server.","consultar":"Cadastre information","infocatastro_obsolete":"Message to the developer: M.plugin.InfoCatastro has been deprecated, please use M.plugin.Locator instead","description":"Description","reference":"Cadastral reference","noReference":"No reference","noInfo":"NO REFERENCES AVAILABLE FOR THESE COORDINATES "}'),d=JSON.parse('{"tooltip":"Consultar Catastro","informacionCatastral":"Información catastral","errorConexion":"No es posible establecer conexión con el servidor de Catastro.","consultar":"Consultar Catastro","infocatastro_obsolete":"Mensaje para el desarrollador: M.plugin.InfoCatastro ha quedado obsoleto, utilice en su lugar M.plugin.Locator","description":"Descripción","reference":"Referencia catastral","noReference":"No hay referencia","noInfo":"PARA ESAS COORDENADAS NO HAY REFERENCIA DISPONIBLE"}');var y={en:p,es:d},b=function(t){var e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e="es","function"==typeof M.language.getLang&&(e=M.language.getLang()),e),n=function(t){return"es"===t||"en"===t?y[t]:M.language.getTranslation(t).infocatastro}(o),r="";return M.utils.isNullOrEmpty(n)?console.warn("The translation '".concat(o,"' has not been defined.")):r=t.split(".").reduce((function(t,e){return t[e]}),n),r};function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function v(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,h(n.key),n)}}function h(t){var e=function(t,e){if("object"!=m(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!=m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==m(e)?e:e+""}function g(t,e,o){return e=w(e),function(t,e){if(e&&("object"==m(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,_()?Reflect.construct(e,o||[],w(t).constructor):e.apply(t,o))}function _(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(_=function(){return!!t})()}function w(t){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},w(t)}function O(t,e){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},O(t,e)}var P=function(t){function e(t){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=g(this,e,[new l,"InfoCatastro"])).facadeMap_=null,o.element_=null,o.catastroWMS=t.url,o.tooltip=t.tooltip,o.POPUP_TITLE=b("informacionCatastral"),o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&O(t,e)}(e,M.Control),o=e,n=[{key:"createView",value:function(t){var e=this;return this.facadeMap_=t,console.warn(b("infocatastro_obsolete")),new Promise((function(t,o){var n=M.template.compileSync(f(),{vars:{translations:{consultar:e.tooltip||b("consultar")}}});e.element_=n,e.element_.querySelector("#m-infocatastro-btn").addEventListener("click",e.activate.bind(e)),t(n)}))}},{key:"activate",value:function(){this.activated?this.deactivate():(this.facadeMap_.on(M.evt.CLICK,this.buildUrl_,this),this.activated=!0,this.element_.querySelector("#m-infocatastro-btn").classList.add("activated"),document.addEventListener("keydown",this.checkEscKey.bind(this)))}},{key:"checkEscKey",value:function(t){"Escape"===t.key&&(this.deactivate(),document.removeEventListener("keydown",this.checkEscKey))}},{key:"deactivate",value:function(){this.facadeMap_.removePopup(),this.facadeMap_.un(M.evt.CLICK,this.buildUrl_,this),this.activated=!1,this.element_.querySelector("#m-infocatastro-btn").classList.remove("activated")}},{key:"buildUrl_",value:function(t){var e=this,o=this.facadeMap_.getProjection().code;M.remote.get(this.catastroWMS,{SRS:o,Coordenada_X:t.coord[0],Coordenada_Y:t.coord[1]}).then((function(o){e.showInfoFromURL_(o,t.coord)}),{jsonp:!0})}},{key:"showInfoFromURL_",value:function(t,e){var o=this;if(200===t.code&&!1===t.error){var n=[],r=t.text,a=this.formatInfo_(r);n.push(a);var i={icon:"g-cartografia-pin",title:this.POPUP_TITLE,content:n.join("")},c=this.facadeMap_.getPopup();if(M.utils.isNullOrEmpty(c))(c=new M.Popup).addTab(i),this.facadeMap_.addPopup(c,e);else if(c.getCoordinate()[0]===e[0]&&c.getCoordinate()[1]===e[1]){var s=!1;c.getTabs().forEach((function(t){t.title!==o.POPUP_TITLE?s=!0:c.removeTab(t)})),s?c.addTab(i):((c=new M.Popup).addTab(i),this.facadeMap_.addPopup(c,e))}else(c=new M.Popup).addTab(i),this.facadeMap_.addPopup(c,e)}else this.facadeMap_.removePopup(),M.dialog.error(b("errorConexion"))}},{key:"formatInfo_",value:function(t){var e,o,n,r,a="",i=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("consulta_coordenadas")[0];if("1"===i.getElementsByTagName("control")[0].getElementsByTagName("cuerr")[0].childNodes[0].nodeValue)o=b("noInfo");else{var c=i.getElementsByTagName("coordenadas")[0].getElementsByTagName("coord")[0],s=c.getElementsByTagName("pc")[0],l=s.getElementsByTagName("pc1")[0].childNodes[0].nodeValue,u=s.getElementsByTagName("pc2")[0].childNodes[0].nodeValue;n=l.substring(0,2),r=l.substring(2,5),e=c.getElementsByTagName("ldt")[0].childNodes[0].nodeValue,o=l+u,a="https://www1.sedecatastro.gob.es/CYCBienInmueble/OVCListaBienes.aspx?del==".concat(n,"&mun=").concat(r,"&rc1=").concat(l,"&rc2=").concat(u)}var f="".concat(M.utils.beautifyAttribute(b("informacionCatastral")),"\n    <div class='divinfo'>\n    <table class='mapea-table'>\n    <tbody>\n    <tr><td class='header' colspan='4'></td></tr>\n    <tr><td class='key'><b>").concat(M.utils.beautifyAttribute(b("reference")),"</b></td><td class='value'></b>\n    <a href='").concat(a,"' target='_blank'>").concat(o,"</a></td></tr>\n    <tr><td class='key'><b>").concat(M.utils.beautifyAttribute(b("description")),"</b></td>\n    <td class='value'>").concat(e,"</td></tr>\n    </tbody></table></div>");return o.toLowerCase().indexOf(b("noReference"))>-1&&(f="".concat(M.utils.beautifyAttribute(b("informacionCatastral")),"\n      <div class='divinfo'>\n      <table class='mapea-table'>\n      <tbody>\n      <tr><td class='header' colspan='4'></td></tr>\n      <tr><td class='key' colspan='4'><b>").concat(o,"</b></td></tr>\n      </tbody></table>\n      </div>")),f}},{key:"equals",value:function(t){return t instanceof e}}],n&&v(o.prototype,n),r&&v(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,n,r}();const C=JSON.parse('{"Pu":{"name":"InfoCatastro","description":"Muestra referencia catastral para un punto y provee de enlace a la información de la DGC","text":"Búsqueda catastral mediante click","version":"2.0.0","date":"09/12/2019","author":"Guadaltel","org":"CNIG","tags":"mapea,plugin","icon":"./facade/assets/icons/icon.svg"}}');function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function S(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,j(n.key),n)}}function j(t){var e=function(t,e){if("object"!=E(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!=E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==E(e)?e:e+""}function T(t,e,o){return e=k(e),function(t,e){if(e&&("object"==E(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,N()?Reflect.construct(e,o||[],k(t).constructor):e.apply(t,o))}function N(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(N=function(){return!!t})()}function k(t){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},k(t)}function R(t,e){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},R(t,e)}var I=function(t){function e(t){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(o=T(this,e)).map_=null,o.controls_=[],o.position_=t.position||"TR",o.tooltip_=t.tooltip||b("tooltip"),o.catastroWMS=t.catastroWMS||"http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCoordenadas.asmx/Consulta_RCCOOR",o.metadata_=C.Pu,o.name_="infocatastro",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&R(t,e)}(e,M.Plugin),o=e,r=[{key:"getJSONTranslations",value:function(t){return"en"===t||"es"===t?"en"===t?p:d:M.language.getTranslation(t).infocatastro}}],(n=[{key:"addTo",value:function(t){this.controls_.push(new P({url:this.catastroWMS,tooltip:this.tooltip_})),this.map_=t,this.panel_=new M.ui.Panel("panelInfoCatastro",{className:"m-plugin-catastro",position:M.ui.position[this.position_],tooltip:this.tooltip_,collapsedButtonClass:"icon-posicion4"}),this.panel_.addControls(this.controls_),t.addPanels(this.panel_);var e=this;this.controls_[0].on(M.evt.ADDED_TO_MAP,(function(){e.fire(M.evt.ADDED_TO_MAP)}))}},{key:"name",get:function(){return"infocatastro"}},{key:"position",get:function(){return this.position_}},{key:"getAPIRest",value:function(){return"".concat(this.name_,"=").concat(this.position_,"*").concat(this.tooltip_,"*").concat(this.catastroWMS)}},{key:"equals",value:function(t){return t instanceof e}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_);var t=[null,null,null];this.map_=t[0],this.controls_=t[1],this.panel_=t[2]}}])&&S(o.prototype,n),r&&S(o,r),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,n,r}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.InfoCatastro=I,window.M.control.InfoCatastroControl=P,window.M.impl.control.InfoCatastroControl=l})()})();
//# sourceMappingURL=infocatastro.ol.min.js.map