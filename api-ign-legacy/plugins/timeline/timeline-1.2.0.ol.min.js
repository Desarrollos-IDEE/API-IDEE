!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e){e.exports=JSON.parse('{"tooltip":"Timeline","title":"Timeline","play":"Play","pause":"Pause","excepcion":"The implementation used cannot create timelineControl controls","intervals_error":"The intervals were not defined correctly","initValue":"Start value","endValue":"Final value","textHelp":{"help1":"The timeline extension.","help2":"The extension is customizable, so you can switch from one viewer to another.","help3":"The timeline allows you to make spatial filters on layers based on a time attribute, or add a date to a layer and filter by it.","help4":"The information relevant to the extension and its possible parameterization is documented in","help5":"The example of use of its parameters can be checked in"}}')},function(e){e.exports=JSON.parse('{"tooltip":"Línea de tiempo","title":"Línea de tiempo","play":"Iniciar","pause":"Parar","excepcion":"La implementación usada no puede crear controles TimelineControl","intervals_error":"Los intervalos no fueron definidos correctamente","initValue":"Valor inicio","endValue":"Valor final","textHelp":{"help1":"La extensión línea de tiempo.","help2":"La extensión es personalizable, por lo que puede cambiar de un visualizador a otro.","help3":"La línea de tiempo permite hacer filtros espaciales en capas a partir de un atributo de tiempo, o añadir una fecha a una capa y filtrar por ella.","help4":"La información relevante a la extensión y su posible parametrización está documentada en","help5":"El ejemplo de uso de sus parámetros puede comprobarse en"}}')},function(e,t){e.exports='<div id="div-contenedor" class="m-timeline-container">\r\n    <div id="m-timeline-title">{{translations.title}}</div>\r\n    <div class="div-m-timeline-panel">\r\n        <div class="div-m-timeline-slider">\r\n            <input type="range" min="0" max="100" value="0" step="any" id="input-slider"></input>\r\n            <div class=\'slider-tags\'></div>\r\n        </div>\r\n        <div class="m-timeline-names">\r\n            \r\n        </div>\r\n        <div class="m-timeline-button">\r\n            <button id="m-timeline-play" class="timeline-control-siguiente" title="Iniciar paso del tiempo"></button>\r\n        </div>\r\n    </div>\r\n</div>'},function(e,t){e.exports='<div id="div-contenedor" class="m-timeline-container {{sizeWidthDinamic}}">\n    <div id="m-timeline-title">{{translations.title}}</div>\n    <div>\n        <div>\n            <div>  \x3c!-- Movil class rotate --\x3e\n                \x3c!-- Basic structure --\x3e\n                <div class=\'wrap\' style=\'--a: -30; --b: 20; --min: -50; --max: 50\'>\n                    <input id=\'a\' type=\'range\' min=\'0\' value=\'0\' max=\'0\'/>\n                    <input id=\'b\' type=\'range\' min=\'0\' value=\'0\' max=\'0\'/>\n                </div>\n            </div>\n        \n            <div class=\'slider-tags-dinamic\'>\n                <div>\n                    <label for="init">{{translations.initValue}}: </label>\n                    <input id="init" type="text">\n                </div>\n                \n                <div>\n                    <label for="init">{{translations.endValue}}: </label>\n                    <input id="end" type="text">\n                </div>\n            </div>\n        </div>\n        <div class="m-timelineDinamic-button">\n\n            <select class="selectDinamicLayer" name="dinamicLayer" id="selectDinamicLayer">\n                <option value=""> Sin Capa </option>\n            </select>\n\n            <button id="m-timelineDinamic-back" class="timelineDinamic-control-play" title="Iniciar paso del tiempo"><<</button>\n            <button id="m-timelineDinamic-play" class="timelineDinamic-control-play" title="Iniciar paso del tiempo">Play/Pausa</button>\n            <button id="m-timelineDinamic-before" class="timelineDinamic-control-play" title="Iniciar paso del tiempo">>></button>\n            \x3c!-- Parametrización del valor incremento de paso --\x3e\n        </div>\n    </div>\n</div>'},function(e){e.exports=JSON.parse('{"url":{"name":"timeline","separator":"*!"},"constructor":"M.plugin.Timeline","parameters":[{"type":"object","properties":[{"type":"simple","name":"position","possibleValues":["TL","TR","BL","BR"],"position":0},{"type":"simple","name":"intervals","position":1},{"type":"boolean","name":"animation","position":2},{"type":"simple","name":"speed","position":3}]}],"files":{"ol":{"scripts":["timeline.ol.min.js"],"styles":["timeline.ol.min.css"]}},"metadata":{"name":"Timeline","description":"Línea de tiempo por intervalos","text":"Plugin que permite mostrar la progresión del tiempo sobre un mapa","version":"1.1.0","date":"Junio, 2020","author":"","org":"CNIG","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","centralized":true}}')},function(e,t,n){e.exports='<div>\n   <h2 style="text-align: center; color: #fff; background-color: #364b5f; padding: 8px 10px;">TIMELINE <img style="vertical-align: bottom; filter: invert(100%);" src="'+n(7)+'" width="30" height="30"></h2>\n   <div>\n      <p>{{translations.help1}}</p>\n      <p>{{translations.help2}}</p>\n      <img src="{{urlImages}}/timeline_0.png" style="max-width:70%; margin: 0 auto; display: block">\n      <p>{{translations.help3}}</p>\n      <p>{{translations.help4}}: <a tabindex="0" href="https://github.com/IGN-CNIG/API-CNIG/tree/master/api-ign-js/src/plugins/timeline" target="_blank">https://github.com/IGN-CNIG/API-CNIG/tree/master/api-ign-js/src/plugins/timeline</a></p>\n      <p>{{translations.help5}}: <a tabindex="0" href="https://componentes.cnig.es/api-core/timeline.jsp?language=es" target="_blank">https://componentes.cnig.es/api-core/timeline.jsp?language=es</a></p>\n   </div>\n</div>\n\n'},function(e,t,n){},function(e,t){e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMjQiIGhlaWdodD0iMTAyNCIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+Cjx0aXRsZT48L3RpdGxlPgo8ZyBpZD0iaWNvbW9vbi1pZ25vcmUiPgo8L2c+CjxwYXRoIGQ9Ik01MTIgMGMtMjgyLjMxNyAwLTUxMiAyMjkuNjgzLTUxMiA1MTJzMjI5LjY4MyA1MTIgNTEyIDUxMiA1MTItMjI5LjY4MyA1MTItNTEyLTIyOS42ODMtNTEyLTUxMi01MTJ6TTUxMiA5MTUuMDU1Yy0yMjIuMjQzIDAtNDAzLjA2Ni0xODAuODAyLTQwMy4wNjYtNDAzLjA1NXMxODAuODIzLTQwMy4wNTUgNDAzLjA2Ni00MDMuMDU1IDQwMy4wNjYgMTgwLjgwMiA0MDMuMDY2IDQwMy4wNTUtMTgwLjgyMyA0MDMuMDU1LTQwMy4wNjYgNDAzLjA1NXpNNzc4LjgzNCA0OTYuMTkxaC0yMzAuMDk0di0yNzYuNjU3YzAtMjMuMjgxLTE4Ljg3Ni00Mi4xNTctNDIuMTU3LTQyLjE1N3MtNDIuMTU3IDE4Ljg3Ni00Mi4xNTcgNDIuMTU3djMxOC44MTRjMCAyMy4yODEgMTguODc2IDQyLjE1NyA0Mi4xNTcgNDIuMTU3aDI3Mi4yNTJjMjMuMjgxIDAgNDIuMTU3LTE4Ljg3NiA0Mi4xNTctNDIuMTU3cy0xOC44NzYtNDIuMTU3LTQyLjE1Ny00Mi4xNTd6Ij48L3BhdGg+Cjwvc3ZnPgo="},function(e,t,n){"use strict";n.r(t);n(6);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(a=r.key,o=void 0,o=function(e,t){if("object"!==i(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a,"string"),"symbol"===i(o)?o:String(o)),r)}var a,o}function o(){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=l(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function l(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=m(e)););return e}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=m(e);if(t){var r=m(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return c(this,n)}}function c(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(c,M.impl.Control);var t,n,i,l=s(c);function c(){return r(this,c),l.apply(this,arguments)}return t=c,(n=[{key:"addTo",value:function(e,t){this.map=e,this.olMap=e.getMapImpl(),o(m(c.prototype),"addTo",this).call(this,e,t)}}])&&a(t.prototype,n),i&&a(t,i),Object.defineProperty(t,"prototype",{writable:!1}),c}(),y=n(2),f=n.n(y),d=n(3),v=n.n(d),h=n(0),g=n(1),b={en:h,es:g},T=function(){var e="es";return"function"==typeof M.language.getLang&&(e=M.language.getLang()),e},D=function(e){return"es"===e||"en"===e?b[e]:M.language.getTranslation(e).timeline},L=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:T(),n=D(t),i="";return M.utils.isNullOrEmpty(n)?console.warn("The translation '".concat(t,"' has not been defined.")):i=e.split(".").reduce((function(e,t){return e[t]}),n),i};function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,l=[],u=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=a.call(n)).done)&&(l.push(i.value),l.length!==t);u=!0);}catch(e){s=!0,r=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw r}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(r=i.key,a=void 0,a=function(e,t){if("object"!==S(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==S(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(r,"string"),"symbol"===S(a)?a:String(a)),i)}var r,a}function x(e,t){return(x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=V(e);if(t){var r=V(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return O(this,n)}}function O(e,t){if(t&&("object"===S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function V(e){return(V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&x(e,t)}(a,M.Control);var t,n,i,r=N(a);function a(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),M.utils.isUndefined(p)&&M.exception(L("exception"));var n=new p;return(t=r.call(this,n,"Timeline")).timelineType=e.timelineType,t.running=!1,t.animation=e.animation,t.speed=e.speed,["absolute","relative"].includes(t.timelineType)?t.intervals=e.intervals?Object.entries(e.intervals).map((function(e){var n=w(e,2),i=(n[0],n[1]),r=w(t.transformTime_NumbToDate(i.init,i.end),2),a=r[0],o=r[1];return i.init=a,i.end=o,i})):void 0:t.intervals=e.intervals,t.paramsDate=e.paramsDate,t.speedDate=e.speedDate,t.stepValue=e.stepValue,t.formatValue=e.formatValue,t.formatMove=e.formatMove,t.sizeWidthDinamic=e.sizeWidthDinamic,t.date={init:0,end:0},t.allLayersDinamic={groupLayer:[],noGroupLayer:[]},t.template=null,t}return t=a,(n=[{key:"createView",value:function(e){var t=this;return this.map=e,new Promise((function(e,n){var i=["absolute","relative"].includes(t.timelineType);if(t.template=M.template.compileSync(i?v.a:f.a,{vars:{translations:{title:L("title"),play:L("play"),initValue:L("initValue"),endValue:L("endValue")},sizeWidthDinamic:t.sizeWidthDinamic}}),i)t.createtimeLineDinamic(),e(t.template);else{var r=[];t.intervals.forEach((function(e,n){var i=t.transformToLayers(e[2]),a=t.getMapLayer(i);void 0!==a&&t.map.removeLayers(a),t.map.addLayers(i);var o={number:n,name:e[0],tag:e[1],service:i};r.push(o)})),t.intervals=r,t.intervals.forEach((function(e,n){var i=document.createElement("div");0!=n&&n!=t.intervals.length-1&&n!=parseInt(t.intervals.length/2)?i.dataset.tag="":i.dataset.tag=e.tag,t.template.querySelector(".slider-tags").append(i)})),t.template.querySelector(".div-m-timeline-panel").style.setProperty("--num",t.intervals.length);var a=t.template.querySelector("#input-slider");a.setAttribute("max",r.length-1),a.addEventListener("input",(function(e){return t.changeSlider(a)})),a.addEventListener("change",(function(e){document.querySelector(".m-timeline-button button").classList.add("timeline-control-siguiente"),document.querySelector(".m-timeline-button button").classList.remove("timeline-control-pausa"),document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","0"),clearTimeout(t.running),t.running=!1})),t.template.querySelector("#m-timeline-play").addEventListener("click",(function(e){return t.playTimeline(!1)})),e(t.template)}}))}},{key:"transformToLayers",value:function(e){var t=null;if(e instanceof Object){if(e instanceof Object){var n=this.map.getLayers().filter((function(t){return e.name.includes(t.name)}))[0];t=this.isValidLayer(n)?n:null}}else if(e.indexOf("*")>=0){var i=e.split("*");"WMS"==i[0].toUpperCase()?t=new M.layer.WMS({url:i[2],name:i[3]}):"WMTS"==i[0].toUpperCase()&&(t=new M.layer.WMTS({url:i[2],name:i[3]}))}else{var r=this.map.getLayers().filter((function(t){return e.includes(t.name)}))[0];t=this.isValidLayer(r)?r:null}if(null!==t)return t.displayInLayerSwitcher=!1,t.setVisible(!1),t;this.map.removeLayers(e)}},{key:"changeSlider",value:function(e){var t=this;document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","0");var n=(e.value-e.min)/(e.max-e.min)*246+5;document.querySelector(".div-m-timeline-slider").style.setProperty("--left",n+"px"),(this.animation||""!==this.intervals[0].name)&&(document.querySelector(".m-timeline-names").style.display="block"),this.animation&&(document.querySelector(".m-timeline-button").style.display="block");var i=parseFloat(e.value);this.intervals.forEach((function(e){t.getMapLayer(e.service).setVisible(!1),document.querySelector(".m-timeline-names").innerHTML=""})),i%1==0?(document.querySelector(".div-m-timeline-slider").style.setProperty("--left",n+20+"px"),this.getMapLayer(this.intervals[i].service).setVisible(!0),document.querySelector(".m-timeline-names").innerHTML=this.intervals[i].name,document.querySelector(".div-m-timeline-panel").style.setProperty("--valor",'"'+this.intervals[i].tag+'"'),""!==this.intervals[i].tag?document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","1"):document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","0")):(this.getMapLayer(this.intervals[parseInt(i)].service).setVisible(!0),this.getMapLayer(this.intervals[parseInt(i)+1].service).setVisible(!0),""!==this.intervals[parseInt(i)].tag&&""!==this.intervals[parseInt(i)+1].tag?(document.querySelector(".div-m-timeline-slider").style.setProperty("--left",n+"px"),document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","1"),document.querySelector(".div-m-timeline-panel").style.setProperty("--valor",'"'+this.intervals[parseInt(i)].tag+" - "+this.intervals[parseInt(i)+1].tag+'"'),document.querySelector(".m-timeline-names").innerHTML=this.intervals[parseInt(i)].name+" y "+this.intervals[parseInt(i)+1].name):""===this.intervals[parseInt(i)].tag&&""===this.intervals[parseInt(i)+1].tag?document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","0"):(document.querySelector(".div-m-timeline-slider").style.setProperty("--left",n+20+"px"),document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","10"),document.querySelector(".m-timeline-names").innerHTML=this.intervals[parseInt(i)].name+this.intervals[parseInt(i)+1].name,document.querySelector(".div-m-timeline-panel").style.setProperty("--valor",'"'+this.intervals[parseInt(i)].tag+this.intervals[parseInt(i)+1].tag+'"')))}},{key:"getMapLayer",value:function(e){return this.map.getLayers().filter((function(t){return t.getImpl().legend===e.getImpl().legend}))[0]}},{key:"playTimeline",value:function(e){var t=this,n=this.intervals.length-1,i=document.querySelector("#input-slider"),r=parseInt(i.value);if(this.running&&(document.querySelector(".m-timeline-button button").classList.add("timeline-control-siguiente"),document.querySelector(".m-timeline-button button").classList.remove("timeline-control-pausa"),clearTimeout(this.running)),!e){if(r>0&&r<n&&this.running)return void(this.running=!1);r>n&&(r=0)}if(r>=n)return i.value=0,void this.changeSlider(i);r<0&&(r=0),i.value=parseFloat(i.value)+1,this.changeSlider(i),document.querySelector(".m-timeline-button button").classList.remove("timeline-control-siguiente"),document.querySelector(".m-timeline-button button").classList.add("timeline-control-pausa"),this.running=setTimeout((function(e){return t.playTimeline(!0)}),1e3*this.speed)}},{key:"removeTimelineLayers",value:function(){var e=this;clearInterval(this.running),this.intervals.forEach((function(t){e.map.removeLayers(e.getMapLayer(t.service))}))}},{key:"equals",value:function(e){return e instanceof a}},{key:"createtimeLineDinamic",value:function(){this.createStepsTimeLine(),this.createSelectorLayers(),this.createInputDate()}},{key:"createInputDate",value:function(){var e=this,t=this.template.querySelector("#init"),n=this.template.querySelector("#end");t.value=this.date.init,n.value=this.date.end,["focusout","keypress"].forEach((function(i){t.addEventListener(i,(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.target,a=t.key,o=void 0!==a&&a;if("focusout"===i||"Enter"===o){var l=e.getValues_inputDate(r.value),u=e.getValues_inputDate(n.value);e.changeDateLayer(new Date(r.value).getTime(),new Date(n.value).getTime()),e.changeValueSlider(l,u)}})),n.addEventListener(i,(function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.target,a=n.key,o=void 0!==a&&a;if("focusout"===i||"Enter"===o){var l=e.getValues_inputDate(r.value),u=e.getValues_inputDate(t.value);e.changeDateLayer(new Date(t.value).getTime(),new Date(r.value).getTime()),e.changeValueSlider(u,l)}}))}))}},{key:"createSelectorLayers",value:function(){var e=this,t=this.template.querySelector("#selectDinamicLayer");this.intervals.forEach((function(n){var i=n.id,r=n.init,a=n.end,o=n.layer,l=n.grupo,u=n.attributeParam,s=n.equalsTimeLine,c=void 0!==s&&s;c||(c="absolute"===e.timelineType);var m=e.transformToLayersDinamic({init:r,end:a},o,i,u,c);if(l){var p=e.allLayersDinamic.groupLayer.find((function(e){return e.name===l}));if(p){var y=t.querySelector("#".concat(l)),f=y.getAttribute("init"),d=y.getAttribute("end");y.setAttribute("init",new Date(f).getTime()<new Date(r).getTime()?f:r),y.setAttribute("end",new Date(d).getTime()>new Date(a).getTime()?d:a),p.layers.push(m)}else e.allLayersDinamic.groupLayer.push({name:l,layers:[m]}),t.innerHTML+='<option id="'.concat(l,'" equalsTimeLine="').concat(c,'" init="').concat(r,'" end="').concat(a,'" value="group">').concat(l,"</option>")}else e.allLayersDinamic.noGroupLayer.push({name:m.name,layers:[m]}),t.innerHTML+='<option id="'.concat(i,'" equalsTimeLine="').concat(c,'" init="').concat(r,'" end="').concat(a,'" value="').concat(i,'">').concat(m.name,"</option>")})),this.selectorEventLayer()}},{key:"createStepsTimeLine",value:function(){var e=this;this.template.querySelector("#m-timelineDinamic-play").addEventListener("click",(function(t){var n=t.target;if(n.classList.contains("active"))clearInterval(n.getAttribute("intervalID")),n.classList.remove("active");else{var i=e.stepsTimeLineDinamic();n.classList.add("active"),n.setAttribute("intervalID",i)}})),[this.template.querySelector("#m-timelineDinamic-back"),this.template.querySelector("#m-timelineDinamic-before")].forEach((function(t){t.addEventListener("click",(function(t){var n=t.target;e.evtFormatMove(n.id)}))}))}},{key:"searchLayerDinamic",value:function(e){return this.intervals.filter((function(t){var n=t.id;return e.id===n}))[0]}},{key:"transformToLayersDinamic",value:function(e,t,n,i,r){var a=e.init,o=e.end;if(t instanceof Object)return M.layer.Vector,t.layerTimeLine=!0,t.id=n,t.attributeParam=i,t.equalsTimeLine=r,t;var l=w(t.split("*"),4),u=l[0],s=l[1],c=l[2],m=l[3],p=new M.layer.WMS({type:u,legend:s,url:c,name:m},{params:{CQL_FILTER:r?"".concat(i," = '").concat(new Date(o).toISOString(),"'"):"".concat(i," DURING ").concat(new Date(a).toISOString(),"/").concat(new Date(o).toISOString())}});return p.id=n,p.layerTimeLine=!0,p.attributeParam=i,p.equalsTimeLine=r,p}},{key:"getValues_inputDate",value:function(e){var t=this.formatValue,n=this.getReverseFormat(t),i=new Date(e).getTime();return this.getFormatValue(i,n)}},{key:"selectorEventLayer",value:function(){var e=this;this.template.querySelector("#selectDinamicLayer").addEventListener("change",(function(t){var n=t.target;if(e.removeLayers(),0===n.selectedIndex)return e.changeValueInputDate("Please choose an option","Please choose an option"),void e.sliderEventDinamic(0,1);var i=n.children[n.selectedIndex],r=i.getAttribute("init"),a=i.getAttribute("end");if("true"===i.getAttribute("equalsTimeLine")?(document.querySelector("#a").setAttribute("disabled",""),document.querySelector("#init").setAttribute("disabled","")):(document.querySelector("#a").removeAttribute("disabled"),document.querySelector("#init").removeAttribute("disabled")),"group"===i.value){var o=e.allLayersDinamic.groupLayer.find((function(e){return e.name===i.id}));e.map.addLayers(o.layers),e.changeVectorLayer(new Date(r).getTime(),new Date(a).getTime(),o.layers),e.changeValueInputDate(r,a),e.sliderEventDinamic(new Date(r).getTime(),new Date(a).getTime())}else{var l=e.allLayersDinamic.noGroupLayer.find((function(e){return e.name,e.layers[0].id===i.id}));e.map.addLayers(l.layers),e.changeVectorLayer(new Date(r).getTime(),new Date(a).getTime(),l.layers),e.changeValueInputDate(r,a),e.sliderEventDinamic(new Date(r).getTime(),new Date(a).getTime())}}))}},{key:"removeLayers",value:function(){var e=this.map.getLayers().filter((function(e){return!0===e.layerTimeLine}));this.map.removeLayers(e)}},{key:"getLayerTimeLine",value:function(){return this.map.getLayers().filter((function(e){return!0===e.layerTimeLine}))}},{key:"sliderEventDinamic",value:function(e,t){var n=this;this.generateValueSlider(e,t),this.template.querySelector(".wrap #a").addEventListener("input",(function(e){var t=e.target,i=Number(document.querySelector(".wrap #b").value);if(Number(t.value)>=i)t.value=i;else{var r=n.formatValue,a=n.getFormatValue(Number(t.value),r),o=n.getFormatValue(Number(i),r);n.changeDateLayer(a,o),n.changeValueInputDate(new Date(a).toISOString(),new Date(o).toISOString())}})),this.template.querySelector(".wrap #b").addEventListener("input",(function(e){var t=e.target,i=Number(document.querySelector(".wrap #a").value);if(Number(t.value)<=i)t.value=i;else{var r=n.formatValue,a=n.getFormatValue(Number(t.value),r),o=n.getFormatValue(Number(i),r);n.changeDateLayer(o,a),n.changeValueInputDate(new Date(o).toISOString(),new Date(a).toISOString())}}))}},{key:"generateValueSlider",value:function(e,t){var n=this.template.querySelector(".wrap #a"),i=this.template.querySelector(".wrap #b"),r=new Date(e).getTime(),a=new Date(t).getTime();n.min=r,n.max=a,n.value=r,i.min=r,i.max=a,i.value=a}},{key:"changeValueInputDate",value:function(e,t){this.template.querySelector("#init").value=e,this.template.querySelector("#end").value=t}},{key:"changeValueSlider",value:function(e,t){this.template.querySelectorAll(".wrap input")[0].value=e,this.template.querySelectorAll(".wrap input")[1].value=t}},{key:"changeDateLayer",value:function(e,t){var n=this,i=Number(e),r=Number(t),a=this.getLayerTimeLine();this.removeLayers(),a.forEach((function(e){if(e instanceof M.layer.Vector)e.on(M.evt.LOAD,(function(){var t=n.searchLayerDinamic(e),a=w(n.getGroupLimit(i,r,t),2),o=a[0],l=a[1],u=new M.filter.Function((function(t){var i=t.getAttributes()[e.attributeParam];if(e.equalsTimeLine){if(l===new Date(n.transformTime_NumbToDate(i)[0]).getTime())return t}else if(o<=new Date(n.transformTime_NumbToDate(i)[0]).getTime()&&l>=new Date(n.transformTime_NumbToDate(i)[0]).getTime())return t}));e.setFilter(u)}));else{var a=n.searchLayerDinamic(e),o=w(n.getGroupLimit(i,r,a),2),l=o[0],u=o[1];e.options.params.CQL_FILTER=e.equalsTimeLine?"".concat(e.attributeParam," = '").concat(new Date(t).toISOString(),"'"):"".concat(e.attributeParam," DURING ").concat(new Date(l).toISOString(),"/").concat(new Date(u).toISOString())}n.map.addLayers(e)}))}},{key:"changeVectorLayer",value:function(e,t,n){var i=this;n.filter((function(e){return e instanceof M.layer.Vector})).forEach((function(n){n.on(M.evt.LOAD,(function(){var r=i.searchLayerDinamic(n),a=w(i.getGroupLimit(e,t,r),2),o=a[0],l=a[1],u=new M.filter.Function((function(e){var t=e.getAttributes()[n.attributeParam];if(n.equalsTimeLine){if(l===new Date(i.transformTime_NumbToDate(t)[0]).getTime())return e}else if(o<=new Date(i.transformTime_NumbToDate(t)[0]).getTime()&&l>=new Date(i.transformTime_NumbToDate(t)[0]).getTime())return e}));n.setFilter(u)}))}))}},{key:"evtFormatMove",value:function(e){var t=this;if(""===this.template.querySelector("#selectDinamicLayer").value)return this.changeValueInputDate("Please choose an option","Please choose an option"),void this.sliderEventDinamic(0,1);var n=this.formatValue,i=this.getReverseFormat(n),r=w(this.getValueDateInput().map((function(n,i){if(0===i&&"discrete"===t.formatMove)return n;if("m-timelineDinamic-before"===e){var r=t.getValueSliderB().max;return t.getValueBeforeEvent(n,r)}var a=t.getValueSliderB().min;return t.getValueBackEvent(n,a)})),2),a=r[0],o=r[1];this.changeValueInputDate(new Date(a).toISOString(),new Date(o).toISOString());var l=w([a,o].map((function(e){return t.getFormatValue(e,i)})),2),u=l[0],s=l[1];this.changeDateLayer(a,o),this.changeValueSlider(u,s)}},{key:"getValueBackEvent",value:function(e,t){return e-this.getStepValue()<=t?t:e-this.getStepValue()}},{key:"getReverseFormat",value:function(e){return"logarithmic"===e?"exponential":"exponential"===e?"logarithmic":"linear"}},{key:"getValueBeforeEvent",value:function(e,t){return e+this.getStepValue()>=t?t:e+this.getStepValue()}},{key:"getValueDateInput",value:function(){var e=document.querySelector("#init").value,t=document.querySelector("#end").value;return[new Date(e).getTime(),new Date(t).getTime()]}},{key:"getFormatValue",value:function(e,t){var n=Number(document.querySelector("#b").max),i=Number(document.querySelector("#b").min),r=t;return"exponential"===r?this.exponential(i,n,e):"logarithmic"===r?this.logarithmic(i,n,e):e}},{key:"getValueSliderB",value:function(){return{min:Number(document.querySelector("#b").min),max:Number(document.querySelector("#b").max),value:Number(document.querySelector("#b").value)}}},{key:"getValueSliderA",value:function(){return{min:Number(document.querySelector("#a").min),max:Number(document.querySelector("#a").max),value:Number(document.querySelector("#a").value)}}},{key:"stepsTimeLineDinamic",value:function(){var e=this;if(""===this.template.querySelector("#selectDinamicLayer").value)return this.changeValueInputDate("Please choose an option","Please choose an option"),void this.sliderEventDinamic(0,1);var t=this.speedDate;return setInterval((function(){e.evtFormatMove("m-timelineDinamic-before")}),1e3*t)}},{key:"getStepValue",value:function(){switch(this.paramsDate){case"sec":return 1e3*this.stepValue;case"min":return 6e4*this.stepValue;case"hrs":return 36e5*this.stepValue;case"day":return 864e5*this.stepValue;case"mos":return 2592e6*this.stepValue;case"yr":return 31104e6*this.stepValue;default:return 864e5}}},{key:"getGroupLimit",value:function(e,t,n){return[e<=new Date(n.init).getTime()?new Date(n.init).getTime():e,t>=new Date(n.end).getTime()?new Date(n.end).getTime():t]}},{key:"transformTime_NumbToDate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[e=isNaN(Number(e))?new Date(e).toISOString():new Date(Number(e)).toISOString(),t=isNaN(Number(t))?new Date(t).toISOString():new Date(Number(t)).toISOString()]}},{key:"logarithmic",value:function(e,t,n){var i=w(this.formatValueType(e,t),3),r=i[0],a=i[2];return e>0?Math.round(Math.exp(r-e*a+a*n)):Math.round(Math.exp(-e*a)*(Math.exp(r+a*n)+e*Math.exp(e*a)-Math.exp(e*a)))}},{key:"formatValueType",value:function(e,t){var n=e,i=t,r=0,a=0;return n>0?(r=Math.log(n),a=Math.log(i)):(r=Math.log(1),a=Math.log(i+Math.abs(n)+1)),[r,a,(a-r)/(i-n)]}},{key:"exponential",value:function(e,t,n){var i=w(this.formatValueType(e,t),3),r=i[0],a=i[2];return e>0?Math.round((Math.log(n)-r)/a+e):Math.round((Math.log(n-e+1)-r)/a+e)}}])&&j(t.prototype,n),i&&j(t,i),Object.defineProperty(t,"prototype",{writable:!1}),a}(),q=n(4),k=n(5),_=n.n(k);function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(r=i.key,a=void 0,a=function(e,t){if("object"!==E(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==E(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(r,"string"),"symbol"===E(a)?a:String(a)),i)}var r,a}function C(e,t){return(C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function z(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=U(e);if(t){var r=U(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return G(this,n)}}function G(e,t){if(t&&("object"===E(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function U(e){return(U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&C(e,t)}(a,M.Plugin);var t,n,i,r=z(a);function a(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A(this,a),(e=r.call(this)).name_="timeline",e.map_=null,e.controls_=[],e.className="m-plugin-timeline";var n=["TR","TL","BL","BR"];return e.position=n.includes(t.position)?t.position:"TR",void 0!==t&&(M.utils.isString(t.intervals)?e.intervals=JSON.parse(t.intervals.replace(/!!/g,"[").replace(/¡¡/g,"]")):M.utils.isArray(t.intervals)&&(e.intervals=t.intervals)),e.animation=t.animation,void 0===e.animation&&(e.animation=!0),e.speed=parseFloat(t.speed)||1,e.metadata_=q.metadata,e.tooltip_=t.tooltip||L("tooltip"),e.speedDate=t.speedDate?t.speedDate:2,e.paramsDate=t.paramsDate?t.paramsDate:"yr",e.stepValue=t.stepValue?t.stepValue:1,e.sizeWidthDinamic=t.sizeWidthDinamic?t.sizeWidthDinamic:"",e.formatMove="discrete"===t.formatMove?"discrete":"continuous",e.formatValue=t.formatValue?t.formatValue:"linear",e.timelineType=t.timelineType||!1,e}return t=a,i=[{key:"getJSONTranslations",value:function(e){return"en"===e||"es"===e?"en"===e?h:g:M.language.getTranslation(e).timeline}}],(n=[{key:"addTo",value:function(e){if(!this.timelineType||!["absoluteSimple","absolute","relative"].includes(this.timelineType))throw new Error("Add correct typesTimeline, (absoluteSimple","absolute","relative)");this.intervals=this.intervals.filter((function(e){var t=e.layer;return"string"==typeof t?!t.includes("GenericRaster")||!t.includes("GenericVector"):"GenericRaster"!==t.type||"GenericVector"!==t.type})),this.control_=new P({intervals:this.intervals,animation:this.animation,speed:this.speed,speedDate:this.speedDate,paramsDate:this.paramsDate,stepValue:this.stepValue,sizeWidthDinamic:this.sizeWidthDinamic,formatMove:this.formatMove,formatValue:this.formatValue,timelineType:this.timelineType}),this.controls_.push(this.control_),this.map_=e,this.panel_=new M.ui.Panel("panelTimeline",{collapsible:!0,position:M.ui.position[this.position],className:this.className,collapsedButtonClass:"timeline-gestion-reloj2",tooltip:this.tooltip_}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_)}},{key:"destroy",value:function(){["absolute","relative"].includes(this.timelineType)?this.control_.removeLayers():this.control_.removeTimelineLayers(),this.map_.removeControls([this.control_]);var e=[null,null,null,null,null];this.control_=e[0],this.panel_=e[1],this.map_=e[2],this.layers=e[3],this.radius=e[4]}},{key:"name",get:function(){return this.name_}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"getAPIRest",value:function(){var e=JSON.stringify(this.intervals).replace(/\[/g,"!!").replace(/\]/g,"¡¡");return"".concat(this.name,"=").concat(this.position,"*!").concat(e,"*!").concat(this.animation,"*!").concat(this.speed)}},{key:"activate",value:function(){this.control_.activate()}},{key:"deactivate",value:function(){this.control_.deactivate()}},{key:"equals",value:function(e){return e instanceof a}},{key:"getHelp",value:function(){return{title:this.name,content:new Promise((function(e){e(M.template.compileSync(_.a,{vars:{urlImages:"".concat(M.config.MAPEA_URL,"plugins/timeline/images/"),translations:{help1:L("textHelp.help1"),help2:L("textHelp.help2"),help3:L("textHelp.help3"),help4:L("textHelp.help4"),help5:L("textHelp.help5")}}}))}))}}}])&&R(t.prototype,n),i&&R(t,i),Object.defineProperty(t,"prototype",{writable:!1}),a}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.Timeline=F,window.M.control.TimelineControl=P,window.M.impl.control.TimelineControl=p}]);
//# sourceMappingURL=timeline-1.2.0.ol.min.js.map