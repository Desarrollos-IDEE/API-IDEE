(()=>{var e={431:(e,t,n)=>{e.exports='<div>\n   <h2 style="text-align: center; color: #fff; background-color: #364b5f; padding: 8px 10px;">TIMELINE <img style="vertical-align: bottom; filter: invert(100%);" src="'+n(914)+'" width="30" height="30"></h2>\n   <div>\n      <p>{{translations.help1}}</p>\n      <p>{{translations.help2}}</p>\n      <img src="{{urlImages}}/timeline_0.png" style="max-width:70%; margin: 0 auto; display: block">\n      <p>{{translations.help3}}</p>\n      <p>{{translations.help4}}: <a tabindex="0" href="https://github.com/IGN-CNIG/API-CNIG/tree/master/api-ign-js/src/plugins/timeline" target="_blank">https://github.com/IGN-CNIG/API-CNIG/tree/master/api-ign-js/src/plugins/timeline</a></p>\n      <p>{{translations.help5}}: <a tabindex="0" href="https://componentes.cnig.es/api-core/timeline.jsp?language=es" target="_blank">https://componentes.cnig.es/api-core/timeline.jsp?language=es</a></p>\n   </div>\n</div>\n'},409:e=>{e.exports='<div id="div-contenedor" class="m-timeline-container">\r\n    <div id="m-timeline-title">{{translations.title}}</div>\r\n    <div class="div-m-timeline-panel">\r\n        <div class="div-m-timeline-slider">\r\n            <input type="range" min="0" max="100" value="0" step="any" id="input-slider"></input>\r\n            <div class=\'slider-tags\'></div>\r\n        </div>\r\n        <div class="m-timeline-names">\r\n\r\n        </div>\r\n        <div class="m-timeline-button">\r\n            <button id="m-timeline-play" class="timeline-control-siguiente" title="Iniciar paso del tiempo"></button>\r\n        </div>\r\n    </div>\r\n</div>'},230:e=>{e.exports='<div id="div-contenedor" class="m-timeline-container {{sizeWidthDinamic}}">\n    <div id="m-timeline-title">{{translations.title}}</div>\n    <div>\n        <div>\n            <div>  \x3c!-- Movil class rotate --\x3e\n                \x3c!-- Basic structure --\x3e\n                <div class=\'wrap\' style=\'--a: -30; --b: 20; --min: -50; --max: 50\'>\n                    <input id=\'a\' type=\'range\' min=\'0\' value=\'0\' max=\'0\'/>\n                    <input id=\'b\' type=\'range\' min=\'0\' value=\'0\' max=\'0\'/>\n                </div>\n            </div>\n\n            <div class=\'slider-tags-dinamic\'>\n                <div>\n                    <label for="init">{{translations.initValue}}: </label>\n                    <input id="init" type="text">\n                </div>\n\n                <div>\n                    <label for="init">{{translations.endValue}}: </label>\n                    <input id="end" type="text">\n                </div>\n            </div>\n        </div>\n        <div class="m-timelineDinamic-button">\n\n            <select class="selectDinamicLayer" name="dinamicLayer" id="selectDinamicLayer">\n                <option value=""> Sin Capa </option>\n            </select>\n\n            <button id="m-timelineDinamic-back" class="timelineDinamic-control-play" title="Iniciar paso del tiempo"><<</button>\n            <button id="m-timelineDinamic-play" class="timelineDinamic-control-play" title="Iniciar paso del tiempo">Play/Pausa</button>\n            <button id="m-timelineDinamic-before" class="timelineDinamic-control-play" title="Iniciar paso del tiempo">>></button>\n            \x3c!-- Parametrización del valor incremento de paso --\x3e\n        </div>\n    </div>\n</div>'},914:e=>{"use strict";e.exports="data:image/svg+xml;base64,PCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMjQiIGhlaWdodD0iMTAyNCIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCI+Cjx0aXRsZT48L3RpdGxlPgo8ZyBpZD0iaWNvbW9vbi1pZ25vcmUiPgo8L2c+CjxwYXRoIGQ9Ik01MTIgMGMtMjgyLjMxNyAwLTUxMiAyMjkuNjgzLTUxMiA1MTJzMjI5LjY4MyA1MTIgNTEyIDUxMiA1MTItMjI5LjY4MyA1MTItNTEyLTIyOS42ODMtNTEyLTUxMi01MTJ6TTUxMiA5MTUuMDU1Yy0yMjIuMjQzIDAtNDAzLjA2Ni0xODAuODAyLTQwMy4wNjYtNDAzLjA1NXMxODAuODIzLTQwMy4wNTUgNDAzLjA2Ni00MDMuMDU1IDQwMy4wNjYgMTgwLjgwMiA0MDMuMDY2IDQwMy4wNTUtMTgwLjgyMyA0MDMuMDU1LTQwMy4wNjYgNDAzLjA1NXpNNzc4LjgzNCA0OTYuMTkxaC0yMzAuMDk0di0yNzYuNjU3YzAtMjMuMjgxLTE4Ljg3Ni00Mi4xNTctNDIuMTU3LTQyLjE1N3MtNDIuMTU3IDE4Ljg3Ni00Mi4xNTcgNDIuMTU3djMxOC44MTRjMCAyMy4yODEgMTguODc2IDQyLjE1NyA0Mi4xNTcgNDIuMTU3aDI3Mi4yNTJjMjMuMjgxIDAgNDIuMTU3LTE4Ljg3NiA0Mi4xNTctNDIuMTU3cy0xOC44NzYtNDIuMTU3LTQyLjE1Ny00Mi4xNTd6Ij48L3BhdGg+Cjwvc3ZnPgo="}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,n||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}function r(t,n,i){return n=l(n),function(t,n){if(n&&("object"==e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(t,a()?Reflect.construct(n,i||[],l(t).constructor):n.apply(t,i))}function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(a=function(){return!!e})()}function o(){return o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},o.apply(null,arguments)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}var s=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),r(this,n,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(n,M.impl.Control),i=n,(a=[{key:"addTo",value:function(e,t){this.map=e,this.olMap=e.getMapImpl(),o(l(n.prototype),"addTo",this).call(this,e,t)}}])&&t(i.prototype,a),s&&t(i,s),Object.defineProperty(i,"prototype",{writable:!1}),i;var i,a,s}(),c=n(409),m=n.n(c),p=n(230),y=n.n(p);const d=JSON.parse('{"tooltip":"Timeline","title":"Timeline","play":"Play","pause":"Pause","excepcion":"The implementation used cannot create timelineControl controls","intervals_error":"The intervals were not defined correctly","initValue":"Start value","endValue":"Final value","textHelp":{"help1":"The timeline extension.","help2":"The extension is customizable, so you can switch from one viewer to another.","help3":"The timeline allows you to make spatial filters on layers based on a time attribute, or add a date to a layer and filter by it.","help4":"The information relevant to the extension and its possible parameterization is documented in","help5":"The example of use of its parameters can be checked in"}}'),v=JSON.parse('{"tooltip":"Línea de tiempo","title":"Línea de tiempo","play":"Iniciar","pause":"Parar","excepcion":"La implementación usada no puede crear controles TimelineControl","intervals_error":"Los intervalos no fueron definidos correctamente","initValue":"Valor inicio","endValue":"Valor final","textHelp":{"help1":"La extensión línea de tiempo.","help2":"La extensión es personalizable, por lo que puede cambiar de un visualizador a otro.","help3":"La línea de tiempo permite hacer filtros espaciales en capas a partir de un atributo de tiempo, o añadir una fecha a una capa y filtrar por ella.","help4":"La información relevante a la extensión y su posible parametrización está documentada en","help5":"El ejemplo de uso de sus parámetros puede comprobarse en"}}');var f={en:d,es:v},h=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t="es","function"==typeof M.language.getLang&&(t=M.language.getLang()),t),i=function(e){return"es"===e||"en"===e?f[e]:M.language.getTranslation(e).timeline}(n),r="";return M.utils.isNullOrEmpty(i)?console.warn("The translation '".concat(n,"' has not been defined.")):r=e.split(".").reduce((function(e,t){return e[t]}),i),r};function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function b(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,a,o,l=[],u=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(i=a.call(n)).done)&&(l.push(i.value),l.length!==t);u=!0);}catch(e){s=!0,r=e}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw r}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function D(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,L(i.key),i)}}function L(e){var t=function(e,t){if("object"!=g(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=g(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==g(t)?t:t+""}function S(e,t,n){return t=I(t),function(e,t){if(t&&("object"==g(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,w()?Reflect.construct(t,n||[],I(e).constructor):t.apply(e,n))}function w(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(w=function(){return!!e})()}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}function N(e,t){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},N(e,t)}var x=function(e){function t(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),M.utils.isUndefined(s)&&M.exception(h("exception"));var i=new s;return(n=S(this,t,[i,"Timeline"])).timelineType=e.timelineType,n.running=!1,n.animation=e.animation,n.speed=e.speed,["absolute","relative"].includes(n.timelineType)?n.intervals=e.intervals?Object.entries(e.intervals).map((function(e){var t=b(e,2),i=(t[0],t[1]),r=b(n.transformTime_NumbToDate(i.init,i.end),2),a=r[0],o=r[1];return i.init=a,i.end=o,i})):void 0:n.intervals=e.intervals,n.paramsDate=e.paramsDate,n.speedDate=e.speedDate,n.stepValue=e.stepValue,n.formatValue=e.formatValue,n.formatMove=e.formatMove,n.sizeWidthDinamic=e.sizeWidthDinamic,n.date={init:0,end:0},n.allLayersDinamic={groupLayer:[],noGroupLayer:[]},n.template=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}(t,M.Control),n=t,i=[{key:"createView",value:function(e){var t=this;return this.map=e,new Promise((function(e,n){var i=["absolute","relative"].includes(t.timelineType);if(t.template=M.template.compileSync(i?y():m(),{vars:{translations:{title:h("title"),play:h("play"),initValue:h("initValue"),endValue:h("endValue")},sizeWidthDinamic:t.sizeWidthDinamic}}),i)t.createtimeLineDinamic(),e(t.template);else{var r=[];t.intervals.forEach((function(e,n){var i=t.transformToLayers(e[2]),a=t.getMapLayer(i);void 0!==a&&t.map.removeLayers(a),t.map.addLayers(i);var o={number:n,name:e[0],tag:e[1],service:i};r.push(o)})),t.intervals=r,t.intervals.forEach((function(e,n){var i=document.createElement("div");0!==n&&n!==t.intervals.length-1&&n!==parseInt(t.intervals.length/2,10)?i.dataset.tag="":i.dataset.tag=e.tag,t.template.querySelector(".slider-tags").append(i)})),t.template.querySelector(".div-m-timeline-panel").style.setProperty("--num",t.intervals.length);var a=t.template.querySelector("#input-slider");a.setAttribute("max",r.length-1),a.addEventListener("input",(function(e){return t.changeSlider(a)})),a.addEventListener("change",(function(e){document.querySelector(".m-timeline-button button").classList.add("timeline-control-siguiente"),document.querySelector(".m-timeline-button button").classList.remove("timeline-control-pausa"),document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","0"),clearTimeout(t.running),t.running=!1})),t.template.querySelector("#m-timeline-play").addEventListener("click",(function(e){return t.playTimeline(!1)})),e(t.template)}}))}},{key:"transformToLayers",value:function(e){var t=null;if(e instanceof Object){if(e instanceof Object){var n=this.map.getLayers().filter((function(t){return e.name.includes(t.name)}))[0];t=this.isValidLayer(n)?n:null}}else if(e.indexOf("*")>=0){var i=e.split("*");"WMS"===i[0].toUpperCase()?t=new M.layer.WMS({url:i[2],name:i[3]}):"WMTS"===i[0].toUpperCase()&&(t=new M.layer.WMTS({url:i[2],name:i[3]}))}else{var r=this.map.getLayers().filter((function(t){return e.includes(t.name)}))[0];t=this.isValidLayer(r)?r:null}if(null!==t)return t.displayInLayerSwitcher=!1,t.setVisible(!1),t;this.map.removeLayers(e)}},{key:"changeSlider",value:function(e){var t=this;document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","0");var n=(e.value-e.min)/(e.max-e.min)*246+5;document.querySelector(".div-m-timeline-slider").style.setProperty("--left","".concat(n,"px")),(this.animation||""!==this.intervals[0].name)&&(document.querySelector(".m-timeline-names").style.display="block"),this.animation&&(document.querySelector(".m-timeline-button").style.display="block");var i=parseFloat(e.value);this.intervals.forEach((function(e){t.getMapLayer(e.service).setVisible(!1),document.querySelector(".m-timeline-names").innerHTML=""})),i%1==0?(document.querySelector(".div-m-timeline-slider").style.setProperty("--left","".concat(n+20,"px")),this.getMapLayer(this.intervals[i].service).setVisible(!0),document.querySelector(".m-timeline-names").innerHTML=this.intervals[i].name,document.querySelector(".div-m-timeline-panel").style.setProperty("--valor",'"'.concat(this.intervals[i].tag,'"')),""!==this.intervals[i].tag?document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","1"):document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","0")):(this.getMapLayer(this.intervals[parseInt(i,10)].service).setVisible(!0),this.getMapLayer(this.intervals[parseInt(i,10)+1].service).setVisible(!0),""!==this.intervals[parseInt(i,10)].tag&&""!==this.intervals[parseInt(i,10)+1].tag?(document.querySelector(".div-m-timeline-slider").style.setProperty("--left","".concat(n,"px")),document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","1"),document.querySelector(".div-m-timeline-panel").style.setProperty("--valor",'"'.concat(this.intervals[parseInt(i,10)].tag," - ").concat(this.intervals[parseInt(i,10)+1].tag,'"')),document.querySelector(".m-timeline-names").innerHTML="".concat(this.intervals[parseInt(i,10)].name," y ").concat(this.intervals[parseInt(i,10)+1].name)):""===this.intervals[parseInt(i,10)].tag&&""===this.intervals[parseInt(i,10)+1].tag?document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","0"):(document.querySelector(".div-m-timeline-slider").style.setProperty("--left","".concat(n+20,"px")),document.querySelector(".div-m-timeline-slider").style.setProperty("--opacity","10"),document.querySelector(".m-timeline-names").innerHTML=this.intervals[parseInt(i,10)].name+this.intervals[parseInt(i,10)+1].name,document.querySelector(".div-m-timeline-panel").style.setProperty("--valor",'"'.concat(this.intervals[parseInt(i,10)].tag).concat(this.intervals[parseInt(i,10)+1].tag,'"'))))}},{key:"getMapLayer",value:function(e){return this.map.getLayers().filter((function(t){return t.getImpl().legend===e.getImpl().legend}))[0]}},{key:"playTimeline",value:function(e){var t=this,n=this.intervals.length-1,i=document.querySelector("#input-slider"),r=parseInt(i.value,10);if(this.running&&(document.querySelector(".m-timeline-button button").classList.add("timeline-control-siguiente"),document.querySelector(".m-timeline-button button").classList.remove("timeline-control-pausa"),clearTimeout(this.running)),!e){if(r>0&&r<n&&this.running)return void(this.running=!1);r>n&&(r=0)}if(r>=n)return i.value=0,void this.changeSlider(i);r<0&&(r=0),i.value=parseFloat(i.value)+1,this.changeSlider(i),document.querySelector(".m-timeline-button button").classList.remove("timeline-control-siguiente"),document.querySelector(".m-timeline-button button").classList.add("timeline-control-pausa"),this.running=setTimeout((function(e){return t.playTimeline(!0)}),1e3*this.speed)}},{key:"removeTimelineLayers",value:function(){var e=this;clearInterval(this.running),this.intervals.forEach((function(t){e.map.removeLayers(e.getMapLayer(t.service))}))}},{key:"equals",value:function(e){return e instanceof t}},{key:"createtimeLineDinamic",value:function(){this.createStepsTimeLine(),this.createSelectorLayers(),this.createInputDate()}},{key:"createInputDate",value:function(){var e=this,t=this.template.querySelector("#init"),n=this.template.querySelector("#end");t.value=this.date.init,n.value=this.date.end,["focusout","keypress"].forEach((function(i){t.addEventListener(i,(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.target,a=t.key;if("focusout"===i||"Enter"===(void 0!==a&&a)){var o=e.getValues_inputDate(r.value),l=e.getValues_inputDate(n.value);e.changeDateLayer(new Date(r.value).getTime(),new Date(n.value).getTime()),e.changeValueSlider(o,l)}})),n.addEventListener(i,(function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.target,a=n.key;if("focusout"===i||"Enter"===(void 0!==a&&a)){var o=e.getValues_inputDate(r.value),l=e.getValues_inputDate(t.value);e.changeDateLayer(new Date(t.value).getTime(),new Date(r.value).getTime()),e.changeValueSlider(l,o)}}))}))}},{key:"createSelectorLayers",value:function(){var e=this,t=this.template.querySelector("#selectDinamicLayer");this.intervals.forEach((function(n){var i=n.id,r=n.init,a=n.end,o=n.layer,l=n.grupo,u=n.attributeParam,s=n.equalsTimeLine,c=void 0!==s&&s;c||(c="absolute"===e.timelineType);var m=e.transformToLayersDinamic({init:r,end:a},o,i,u,c);if(l){var p=e.allLayersDinamic.groupLayer.find((function(e){return e.name===l}));if(p){var y=t.querySelector("#".concat(l)),d=y.getAttribute("init"),v=y.getAttribute("end");y.setAttribute("init",new Date(d).getTime()<new Date(r).getTime()?d:r),y.setAttribute("end",new Date(v).getTime()>new Date(a).getTime()?v:a),p.layers.push(m)}else e.allLayersDinamic.groupLayer.push({name:l,layers:[m]}),t.innerHTML+='<option id="'.concat(l,'" equalsTimeLine="').concat(c,'" init="').concat(r,'" end="').concat(a,'" value="group">').concat(l,"</option>")}else e.allLayersDinamic.noGroupLayer.push({name:m.name,layers:[m]}),t.innerHTML+='<option id="'.concat(i,'" equalsTimeLine="').concat(c,'" init="').concat(r,'" end="').concat(a,'" value="').concat(i,'">').concat(m.name,"</option>")})),this.selectorEventLayer()}},{key:"createStepsTimeLine",value:function(){var e=this;this.template.querySelector("#m-timelineDinamic-play").addEventListener("click",(function(t){var n=t.target;if(n.classList.contains("active"))clearInterval(n.getAttribute("intervalID")),n.classList.remove("active");else{var i=e.stepsTimeLineDinamic();n.classList.add("active"),n.setAttribute("intervalID",i)}})),[this.template.querySelector("#m-timelineDinamic-back"),this.template.querySelector("#m-timelineDinamic-before")].forEach((function(t){t.addEventListener("click",(function(t){var n=t.target;e.evtFormatMove(n.id)}))}))}},{key:"searchLayerDinamic",value:function(e){return this.intervals.filter((function(t){var n=t.id;return e.id===n}))[0]}},{key:"transformToLayersDinamic",value:function(e,t,n,i,r){var a=e.init,o=e.end,l=t;if(!(l instanceof Object)){var u=b(l.split("*"),4),s=u[0],c=u[1],m=u[2],p=u[3],y=new M.layer.WMS({type:s,legend:c,url:m,name:p},{params:{CQL_FILTER:r?"".concat(i," = '").concat(new Date(o).toISOString(),"'"):"".concat(i," DURING ").concat(new Date(a).toISOString(),"/").concat(new Date(o).toISOString())}});return y.id=n,y.layerTimeLine=!0,y.attributeParam=i,y.equalsTimeLine=r,y}return M.layer.Vector,l.layerTimeLine=!0,l.id=n,l.attributeParam=i,l.equalsTimeLine=r,l}},{key:"getValues_inputDate",value:function(e){var t=this.formatValue,n=this.getReverseFormat(t),i=new Date(e).getTime();return this.getFormatValue(i,n)}},{key:"selectorEventLayer",value:function(){var e=this;this.template.querySelector("#selectDinamicLayer").addEventListener("change",(function(t){var n=t.target;if(e.removeLayers(),0===n.selectedIndex)return e.changeValueInputDate("Please choose an option","Please choose an option"),void e.sliderEventDinamic(0,1);var i=n.children[n.selectedIndex],r=i.getAttribute("init"),a=i.getAttribute("end");if("true"===i.getAttribute("equalsTimeLine")?(document.querySelector("#a").setAttribute("disabled",""),document.querySelector("#init").setAttribute("disabled","")):(document.querySelector("#a").removeAttribute("disabled"),document.querySelector("#init").removeAttribute("disabled")),"group"===i.value){var o=e.allLayersDinamic.groupLayer.find((function(e){return e.name===i.id}));e.map.addLayers(o.layers),e.changeVectorLayer(new Date(r).getTime(),new Date(a).getTime(),o.layers),e.changeValueInputDate(r,a),e.sliderEventDinamic(new Date(r).getTime(),new Date(a).getTime())}else{var l=e.allLayersDinamic.noGroupLayer.find((function(e){return e.name,e.layers[0].id===i.id}));e.map.addLayers(l.layers),e.changeVectorLayer(new Date(r).getTime(),new Date(a).getTime(),l.layers),e.changeValueInputDate(r,a),e.sliderEventDinamic(new Date(r).getTime(),new Date(a).getTime())}}))}},{key:"removeLayers",value:function(){var e=this.map.getLayers().filter((function(e){return!0===e.layerTimeLine}));this.map.removeLayers(e)}},{key:"getLayerTimeLine",value:function(){return this.map.getLayers().filter((function(e){return!0===e.layerTimeLine}))}},{key:"sliderEventDinamic",value:function(e,t){var n=this;this.generateValueSlider(e,t),this.template.querySelector(".wrap #a").addEventListener("input",(function(e){var t=e.target,i=Number(document.querySelector(".wrap #b").value);if(Number(t.value)>=i)t.value=i;else{var r=n.formatValue,a=n.getFormatValue(Number(t.value),r),o=n.getFormatValue(Number(i),r);n.changeDateLayer(a,o),n.changeValueInputDate(new Date(a).toISOString(),new Date(o).toISOString())}})),this.template.querySelector(".wrap #b").addEventListener("input",(function(e){var t=e.target,i=Number(document.querySelector(".wrap #a").value);if(Number(t.value)<=i)t.value=i;else{var r=n.formatValue,a=n.getFormatValue(Number(t.value),r),o=n.getFormatValue(Number(i),r);n.changeDateLayer(o,a),n.changeValueInputDate(new Date(o).toISOString(),new Date(a).toISOString())}}))}},{key:"generateValueSlider",value:function(e,t){var n=this.template.querySelector(".wrap #a"),i=this.template.querySelector(".wrap #b"),r=new Date(e).getTime(),a=new Date(t).getTime();n.min=r,n.max=a,n.value=r,i.min=r,i.max=a,i.value=a}},{key:"changeValueInputDate",value:function(e,t){this.template.querySelector("#init").value=e,this.template.querySelector("#end").value=t}},{key:"changeValueSlider",value:function(e,t){this.template.querySelectorAll(".wrap input")[0].value=e,this.template.querySelectorAll(".wrap input")[1].value=t}},{key:"changeDateLayer",value:function(e,t){var n=this,i=Number(e),r=Number(t),a=this.getLayerTimeLine();this.removeLayers(),a.forEach((function(e){if(e instanceof M.layer.Vector)e.on(M.evt.LOAD,(function(){var t=n.searchLayerDinamic(e),a=b(n.getGroupLimit(i,r,t),2),o=a[0],l=a[1],u=new M.filter.Function((function(t){var i=t.getAttributes()[e.attributeParam];return e.equalsTimeLine&&l===new Date(n.transformTime_NumbToDate(i)[0]).getTime()||o<=new Date(n.transformTime_NumbToDate(i)[0]).getTime()&&l>=new Date(n.transformTime_NumbToDate(i)[0]).getTime()?t:void 0}));e.setFilter(u)}));else{var a=n.searchLayerDinamic(e),o=b(n.getGroupLimit(i,r,a),2),l=o[0],u=o[1];e.options.params.CQL_FILTER=e.equalsTimeLine?"".concat(e.attributeParam," = '").concat(new Date(t).toISOString(),"'"):"".concat(e.attributeParam," DURING ").concat(new Date(l).toISOString(),"/").concat(new Date(u).toISOString())}n.map.addLayers(e)}))}},{key:"changeVectorLayer",value:function(e,t,n){var i=this;n.filter((function(e){return e instanceof M.layer.Vector})).forEach((function(n){n.on(M.evt.LOAD,(function(){var r=i.searchLayerDinamic(n),a=b(i.getGroupLimit(e,t,r),2),o=a[0],l=a[1],u=new M.filter.Function((function(e){var t=e.getAttributes()[n.attributeParam];if(n.equalsTimeLine){if(l===new Date(i.transformTime_NumbToDate(t)[0]).getTime())return e;if(o<=new Date(i.transformTime_NumbToDate(t)[0]).getTime()&&l>=new Date(i.transformTime_NumbToDate(t)[0]).getTime())return e}}));n.setFilter(u)}))}))}},{key:"evtFormatMove",value:function(e){var t=this;if(""===this.template.querySelector("#selectDinamicLayer").value)return this.changeValueInputDate("Please choose an option","Please choose an option"),void this.sliderEventDinamic(0,1);var n=this.formatValue,i=this.getReverseFormat(n),r=b(this.getValueDateInput().map((function(n,i){if(0===i&&"discrete"===t.formatMove)return n;if("m-timelineDinamic-before"===e){var r=t.getValueSliderB().max;return t.getValueBeforeEvent(n,r)}var a=t.getValueSliderB().min;return t.getValueBackEvent(n,a)})),2),a=r[0],o=r[1];this.changeValueInputDate(new Date(a).toISOString(),new Date(o).toISOString());var l=b([a,o].map((function(e){return t.getFormatValue(e,i)})),2),u=l[0],s=l[1];this.changeDateLayer(a,o),this.changeValueSlider(u,s)}},{key:"getValueBackEvent",value:function(e,t){return e-this.getStepValue()<=t?t:e-this.getStepValue()}},{key:"getReverseFormat",value:function(e){return"logarithmic"===e?"exponential":"exponential"===e?"logarithmic":"linear"}},{key:"getValueBeforeEvent",value:function(e,t){return e+this.getStepValue()>=t?t:e+this.getStepValue()}},{key:"getValueDateInput",value:function(){var e=document.querySelector("#init").value,t=document.querySelector("#end").value;return[new Date(e).getTime(),new Date(t).getTime()]}},{key:"getFormatValue",value:function(e,t){var n=Number(document.querySelector("#b").max),i=Number(document.querySelector("#b").min),r=t;return"exponential"===r?this.exponential(i,n,e):"logarithmic"===r?this.logarithmic(i,n,e):e}},{key:"getValueSliderB",value:function(){return{min:Number(document.querySelector("#b").min),max:Number(document.querySelector("#b").max),value:Number(document.querySelector("#b").value)}}},{key:"getValueSliderA",value:function(){return{min:Number(document.querySelector("#a").min),max:Number(document.querySelector("#a").max),value:Number(document.querySelector("#a").value)}}},{key:"stepsTimeLineDinamic",value:function(){var e=this;if(""===this.template.querySelector("#selectDinamicLayer").value)return this.changeValueInputDate("Please choose an option","Please choose an option"),void this.sliderEventDinamic(0,1);var t=this.speedDate;return setInterval((function(){e.evtFormatMove("m-timelineDinamic-before")}),1e3*t)}},{key:"getStepValue",value:function(){switch(this.paramsDate){case"sec":return 1e3*this.stepValue;case"min":return 6e4*this.stepValue;case"hrs":return 36e5*this.stepValue;case"day":return 864e5*this.stepValue;case"mos":return 2592e6*this.stepValue;case"yr":return 31104e6*this.stepValue;default:return 864e5}}},{key:"getGroupLimit",value:function(e,t,n){return[e<=new Date(n.init).getTime()?new Date(n.init).getTime():e,t>=new Date(n.end).getTime()?new Date(n.end).getTime():t]}},{key:"transformTime_NumbToDate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[Number.isNaN(Number(e))?new Date(e).toISOString():new Date(Number(e)).toISOString(),Number.isNaN(Number(t))?new Date(t).toISOString():new Date(Number(t)).toISOString()]}},{key:"logarithmic",value:function(e,t,n){var i=b(this.formatValueType(e,t),3),r=i[0],a=i[2];return e>0?Math.round(Math.exp(r-e*a+a*n)):Math.round(Math.exp(-e*a)*(Math.exp(r+a*n)+e*Math.exp(e*a)-Math.exp(e*a)))}},{key:"formatValueType",value:function(e,t){var n=e,i=t,r=0,a=0;return n>0?(r=Math.log(n),a=Math.log(i)):(r=Math.log(1),a=Math.log(i+Math.abs(n)+1)),[r,a,(a-r)/(i-n)]}},{key:"exponential",value:function(e,t,n){var i=b(this.formatValueType(e,t),3),r=i[0],a=i[2];return e>0?Math.round((Math.log(n)-r)/a+e):Math.round((Math.log(n-e+1)-r)/a+e)}}],i&&D(n.prototype,i),r&&D(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,i,r}();const V=JSON.parse('{"Pu":{"name":"Timeline","description":"Línea de tiempo por intervalos","text":"Plugin que permite mostrar la progresión del tiempo sobre un mapa","version":"2.0.0","date":"Junio, 2020","author":"","org":"CNIG","tags":"mapea,plugin","icon":"./facade/assets/icons/icons.svg","centralized":true}}');var j=n(431),O=n.n(j);function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}function q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,k(i.key),i)}}function k(e){var t=function(e,t){if("object"!=P(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=P(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==P(t)?t:t+""}function E(e,t,n){return t=A(t),function(e,t){if(t&&("object"==P(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,_()?Reflect.construct(t,n||[],A(e).constructor):t.apply(e,n))}function _(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_=function(){return!!e})()}function A(e){return A=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},A(e)}function C(e,t){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},C(e,t)}var z=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=E(this,t)).name_="timeline",e.map_=null,e.controls_=[],e.className="m-plugin-timeline";return e.position=["TR","TL","BL","BR"].includes(n.position)?n.position:"TR",void 0!==n&&(M.utils.isString(n.intervals)?e.intervals=JSON.parse(n.intervals.replace(/!!/g,"[").replace(/¡¡/g,"]")):M.utils.isArray(n.intervals)&&(e.intervals=n.intervals)),e.animation=n.animation,void 0===e.animation&&(e.animation=!0),e.speed=parseFloat(n.speed)||1,e.metadata_=V.Pu,e.tooltip_=n.tooltip||h("tooltip"),e.speedDate=n.speedDate?n.speedDate:2,e.paramsDate=n.paramsDate?n.paramsDate:"yr",e.stepValue=n.stepValue?n.stepValue:1,e.sizeWidthDinamic=n.sizeWidthDinamic?n.sizeWidthDinamic:"",e.formatMove="discrete"===n.formatMove?"discrete":"continuous",e.formatValue=n.formatValue?n.formatValue:"linear",e.timelineType=n.timelineType||!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&C(e,t)}(t,M.Plugin),n=t,r=[{key:"getJSONTranslations",value:function(e){return"en"===e||"es"===e?"en"===e?d:v:M.language.getTranslation(e).timeline}}],(i=[{key:"addTo",value:function(e){if(!this.timelineType||!["absoluteSimple","absolute","relative"].includes(this.timelineType))throw new Error("Add correct typesTimeline, (absoluteSimple","absolute","relative)");"absolute"===this.typesTimeline||"relative"===this.typesTimeline?this.intervals=this.intervals.filter((function(e){var t=e.layer;return"string"==typeof t?!t.includes("GenericRaster")||!t.includes("GenericVector"):"GenericRaster"!==t.type||"GenericVector"!==t.type})):this.intervals=this.intervals.filter((function(e){return"string"==typeof e?!e.includes("GenericRaster")||!e.includes("GenericVector"):"GenericRaster"!==e.type||"GenericVector"!==e.type})),this.control_=new x({intervals:this.intervals,animation:this.animation,speed:this.speed,speedDate:this.speedDate,paramsDate:this.paramsDate,stepValue:this.stepValue,sizeWidthDinamic:this.sizeWidthDinamic,formatMove:this.formatMove,formatValue:this.formatValue,timelineType:this.timelineType}),this.controls_.push(this.control_),this.map_=e,this.panel_=new M.ui.Panel("panelTimeline",{collapsible:!0,position:M.ui.position[this.position],className:this.className,collapsedButtonClass:"timeline-gestion-reloj2",tooltip:this.tooltip_}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_)}},{key:"destroy",value:function(){["absolute","relative"].includes(this.timelineType)?this.control_.removeLayers():this.control_.removeTimelineLayers(),this.map_.removeControls([this.control_]);var e=[null,null,null,null,null];this.control_=e[0],this.panel_=e[1],this.map_=e[2],this.layers=e[3],this.radius=e[4]}},{key:"name",get:function(){return this.name_}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"getAPIRest",value:function(){var e=JSON.stringify(this.intervals).replace(/\[/g,"!!").replace(/\]/g,"¡¡");return"".concat(this.name,"=").concat(this.position,"*!").concat(e,"*!").concat(this.animation,"*!").concat(this.speed)}},{key:"activate",value:function(){this.control_.activate()}},{key:"deactivate",value:function(){this.control_.deactivate()}},{key:"equals",value:function(e){return e instanceof t}},{key:"getHelp",value:function(){return{title:this.name,content:new Promise((function(e){e(M.template.compileSync(O(),{vars:{urlImages:"".concat(M.config.MAPEA_URL,"plugins/timeline/images/"),translations:{help1:h("textHelp.help1"),help2:h("textHelp.help2"),help3:h("textHelp.help3"),help4:h("textHelp.help4"),help5:h("textHelp.help5")}}}))}))}}}])&&q(n.prototype,i),r&&q(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,i,r}();window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.Timeline=z,window.M.control.TimelineControl=x,window.M.impl.control.TimelineControl=s})()})();
//# sourceMappingURL=timeline.ol.min.js.map