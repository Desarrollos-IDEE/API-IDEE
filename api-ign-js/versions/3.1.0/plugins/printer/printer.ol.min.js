!function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports='<div class="m-control m-container m-printer m-printer-container">\n    \x3c!-- TITLE --\x3e\n    <div class="title">Impresión del mapa</div>\n    \x3c!-- FORM --\x3e\n    <div class="form">\n        \x3c!-- title --\x3e\n        <div class="title">\n            <input type="text" placeholder="Título">\n        </div>\n        \x3c!-- description --\x3e\n        <div class="description">\n            <textarea placeholder="Descripción"></textarea>\n        </div>\n        \x3c!-- layout --\x3e\n        <div class="layout">\n            <label>Plantilla </label>\n            <select>\n                {{#each layouts}}\n                    <option value="{{name}}" {{#if default}} selected{{/if}}>{{name}}</option>\n                {{/each}}\n            </select>\n        </div>\n        \x3c!-- DPI --\x3e\n        <div class="dpi">\n            <label>DPI </label>\n            <select>\n                {{#each dpis}}\n                    <option value="{{value}}" {{#if default}} selected{{/if}}>{{value}}</option>\n                {{/each}}\n            </select>\n        </div>\n        \x3c!-- format --\x3e\n        <div class="format">\n            <label>Formato </label>\n            <select>\n                {{#each format}}\n                    <option value="{{name}}" {{#if default}} selected{{/if}}>{{name}}</option>\n                {{/each}}\n            </select>\n        </div>\n        \x3c!-- force scale --\x3e\n        <div class="forcescale">\n            <label>Forzar escala </label>\n            <input type="checkbox" {{#if forceScale}} checked{{/if}}>\n        </div>\n    </div>\n    \x3c!-- buttons --\x3e\n    <div class="button">\n        <button class="print"><i class="icon-impresora"></i> Imprimir</button>\n        <button class="remove"><i class="icon-papelera"></i> Borrar</button>\n    </div>\n    \x3c!-- queue --\x3e\n    <div class="queue">\n        <div class="title">Descargar</div>\n        <ul class="queue-container"></ul>\n    </div>\n    \x3c!-- minimize button --\x3e\n    <div class="minimize" title="Minimizar el control de impresión"></div>\n</div>\n'},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(1);function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=r(this,l(t).call(this))).facadeMap_=null,e}var n,i,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(t,M.impl.Control),n=t,(i=[{key:"addTo",value:function(e,t){this.facadeMap_=e,ol.control.Control.call(this,{element:t,target:null}),e.getMapImpl().addControl(this)}},{key:"encodeLayer",value:function(e){var t=this;return new Promise((function(n,i){e.type===M.layer.type.WMC||(e.type===M.layer.type.KML?n(t.encodeKML(e)):e.type===M.layer.type.WMS?n(t.encodeWMS(e)):e.type===M.layer.type.WFS?n(t.encodeWFS(e)):e.type===M.layer.type.GeoJSON?n(t.encodeWFS(e)):e.type===M.layer.type.WMTS?t.encodeWMTS(e).then((function(e){n(e)})):e.type===M.layer.type.MBtiles||(e.type===M.layer.type.OSM?n(t.encodeOSM(e)):e.type===M.layer.type.Mapbox?n(t.encodeMapbox(e)):(M.utils.isNullOrEmpty(e.type)&&M.layer.Vector,n(t.encodeWFS(e)))))}))}},{key:"encodeKML",value:function(e){var t=e.getImpl().getOL3Layer(),n=t.getSource().getFeatures(),i=e.name,o=t.getOpacity(),r=new ol.format.GeoJSON,l=this.facadeMap_.getBbox();l=[l.x.min,l.y.min,l.x.max,l.y.max];var a,s,u=this.facadeMap_.getMapImpl().getView().getResolution(),c=[],p=1,y=1,f=1,m="",d={},g={};return n.forEach((function(e){var t=e.getGeometry(),n=e.get("styleUrl");M.utils.isNullOrEmpty(n)||(n=n.replace("#",""));var i=e.getStyle();if(!M.utils.isNullOrEmpty(i)){var o;try{o=i(e,u)[0]}catch(t){o=i.call(e,u)[0]}if(!M.utils.isNullOrEmpty(o)){var v,h=o.getImage(),b=h.getImageSize();M.utils.isNullOrEmpty(b)&&(b=[64,64]),v="multipolygon"===e.getGeometry().getType().toLowerCase()?"polygon":"multipoint"===e.getGeometry().getType().toLowerCase()?"point":e.getGeometry().getType().toLowerCase();var _,O=o.getStroke(),S={id:n,externalGraphic:h.getSrc(),graphicHeight:b[0],graphicWidth:b[1],graphicOpacity:h.getOpacity(),strokeWidth:O.getWidth(),type:v},x=o.getText&&o.getText();if(M.utils.isNullOrEmpty(x)||((_={conflictResolution:"false",fontColor:M.utils.isNullOrEmpty(x.getFill())?"":M.utils.rgbToHex(M.utils.isArray(x.getFill().getColor())?"rgba(".concat(x.getFill().getColor().toString(),")"):x.getFill().getColor()),fontSize:"11px",fontFamily:"Helvetica, sans-serif",fontWeight:"bold",label:M.utils.isNullOrEmpty(x.getText())?e.get("name"):x.getText(),labelAlign:x.getTextAlign(),labelXOffset:x.getOffsetX(),labelYOffset:x.getOffsetY(),labelOutlineColor:M.utils.isNullOrEmpty(x.getStroke())?"":M.utils.rgbToHex(M.utils.isArray(x.getStroke().getColor())?"rgba(".concat(x.getStroke().getColor().toString(),")"):x.getStroke().getColor()),labelOutlineWidth:M.utils.isNullOrEmpty(x.getStroke())?"":x.getStroke().getWidth(),type:"text"}).fontColor=_.fontColor.slice(0,7),_.labelOutlineColor=_.labelOutlineColor.slice(0,7)),a="draw".concat(f),!M.utils.isNullOrEmpty(t)&&t.intersectsExtent(l)||!M.utils.isNullOrEmpty(x)){var E=JSON.stringify(S),T=JSON.stringify(_),N=d[E],C=g[T];if(M.utils.isUndefined(N)||M.utils.isUndefined(C)){var L=[],P=0;if(!M.utils.isNullOrEmpty(t)&&t.intersectsExtent(l)&&M.utils.isUndefined(N)&&(N=y,d[E]=N,P=1,L.push(E),y+=1,f+=1),!M.utils.isNullOrEmpty(x)&&M.utils.isUndefined(C)&&(C=p,g[T]=C,L.push(T),p+=1,0===P&&(f+=1,L.push(E))),void 0===N&&(N=0),void 0===C&&(C=0),s="\"[_gx_style ='".concat(N+C,"']\""),!M.utils.isNullOrEmpty(L)){var w="".concat(s,': {"symbolizers": [').concat(L,"]}");m+=""!==m?",".concat(w):"{".concat(w,', "version": "2"')}}var k=r.writeFeatureObject(e);k.properties={name:a,_gx_style:N+C},c.push(k)}}}}),this),{type:"Vector",style:m=""!==m?JSON.parse(m.concat("}")):{"*":{symbolizers:[]},version:"2"},styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:c},name:i,opacity:o}}},{key:"encodeWMS",value:function(e){var t=null,n=e.getImpl().getOL3Layer(),i=e.url,o=n.getOpacity(),r=n.getSource().getParams(),l=[r.LAYERS],a=r.FORMAT,s=[r.STYLES];if(t={baseURL:i,opacity:o,type:"WMS",layers:l.join(",").split(","),format:a||"image/jpeg",styles:s.join(",").split(",")},e._updateNoCache){e._updateNoCache();var u=e.getNoCacheName(),c=e.getNoCacheUrl();M.utils.isNullOrEmpty(u)||M.utils.isNullOrEmpty(c)||(t.layers=[u],t.baseURL=c)}else{var p=e.getNoChacheName(),y=e.getNoChacheUrl();M.utils.isNullOrEmpty(p)||M.utils.isNullOrEmpty(y)||(t.layers=[p],t.baseURL=y)}return t.customParams={},Object.keys(r).forEach((function(e){-1!=="iswmc,transparent".indexOf(e.toLowerCase())&&(t.customParams[e]=r[e])})),t}},{key:"encodeWFS",value:function(e){var t=this,n=this.facadeMap_.getProjection(),i=e.getImpl().getOL3Layer(),o=i.getSource().getFeatures(),r=e.name,l=i.getOpacity(),a=i.getStyle(),s=new ol.format.GeoJSON,u=this.facadeMap_.getBbox();u=[u.x.min,u.y.min,u.x.max,u.y.max];var c,p,y=this.facadeMap_.getMapImpl().getView().getResolution(),f=[],m=1,d=1,g=1,v="",h={},b={};return o.forEach((function(e){var i,o=e.getGeometry(),r=e.getStyle();if(M.utils.isNullOrEmpty(r)?M.utils.isNullOrEmpty(a)||(i=a):i=r,i instanceof Function&&(i=i.call(i,e,y)),i instanceof Array&&(i=i.length>1&&!M.utils.isNullOrEmpty(i[1].getImage())&&i[1].getImage().getSrc?i[1]:i[0]),!M.utils.isNullOrEmpty(i)){var l,_=i.getImage(),O=M.utils.isNullOrEmpty(_)?[0,0]:_.getImageSize()||[24,24],S=i.getText();M.utils.isNullOrEmpty(S)&&!M.utils.isNullOrEmpty(i.textPath)&&(S=i.textPath),l="multipolygon"===e.getGeometry().getType().toLowerCase()?"polygon":"multipoint"===e.getGeometry().getType().toLowerCase()?"point":"multilinestring"===e.getGeometry().getType().toLowerCase()?"line":e.getGeometry().getType().toLowerCase();var x,E=M.utils.isNullOrEmpty(_)?i.getStroke():_.getStroke&&_.getStroke(),T=M.utils.isNullOrEmpty(_)?i.getFill():_.getFill&&_.getFill(),N={type:l,fillColor:M.utils.isNullOrEmpty(T)?"#000000":M.utils.rgbaToHex(T.getColor()).slice(0,7),fillOpacity:M.utils.isNullOrEmpty(T)?0:M.utils.getOpacityFromRgba(T.getColor()),strokeColor:M.utils.isNullOrEmpty(E)?"#000000":M.utils.rgbaToHex(E.getColor()),strokeOpacity:M.utils.isNullOrEmpty(E)?0:M.utils.getOpacityFromRgba(E.getColor()),strokeWidth:M.utils.isNullOrEmpty(E)?0:E.getWidth&&E.getWidth(),pointRadius:M.utils.isNullOrEmpty(_)?"":_.getRadius&&_.getRadius(),externalGraphic:M.utils.isNullOrEmpty(_)?"":_.getSrc&&_.getSrc(),graphicHeight:O[0],graphicWidth:O[1]};if(!M.utils.isNullOrEmpty(S)){var C=S.getTextAlign(),L=S.getTextBaseline(),P="";M.utils.isNullOrEmpty(C)||(C=C===M.style.align.LEFT?"l":C===M.style.align.RIGHT?"r":C===M.style.align.CENTER?"c":""),M.utils.isNullOrEmpty(L)||(L=L===M.style.baseline.BOTTOM?"b":L===M.style.baseline.MIDDLE?"m":L===M.style.baseline.TOP?"t":""),M.utils.isNullOrEmpty(C)||M.utils.isNullOrEmpty(L)||(P=C.concat(L));var w=S.getFont(),k=!M.utils.isNullOrEmpty(w)&&w.indexOf("bold")>-1?"bold":"normal",j="11px";if(!M.utils.isNullOrEmpty(w)){var D=w.substr(0,w.indexOf("px"));if(!M.utils.isNullOrEmpty(D)){var I=D.lastIndexOf(" ");j=I>-1?D.substr(I,D.length).trim().concat("px"):D.concat("px")}}x={type:"text",label:S.getText(),fontColor:M.utils.isNullOrEmpty(S.getFill())?"#000000":M.utils.rgbToHex(S.getFill().getColor()),fontSize:j,fontFamily:"Helvetica, sans-serif",fontStyle:"normal",fontWeight:k,conflictResolution:"false",labelXOffset:S.getOffsetX(),labelYOffset:S.getOffsetY(),fillColor:N.fillColor||"#FF0000",fillOpacity:N.fillOpacity||1,labelOutlineColor:M.utils.isNullOrEmpty(S.getStroke())?"":M.utils.rgbToHex(S.getStroke().getColor()||"#FF0000"),labelOutlineWidth:M.utils.isNullOrEmpty(S.getStroke())?"":S.getStroke().getWidth(),labelAlign:P}}if(c="draw".concat(m),!M.utils.isNullOrEmpty(o)&&o.intersectsExtent(u)||!M.utils.isNullOrEmpty(S)){var A,F=JSON.stringify(N),G=JSON.stringify(x),R=h[F],U=b[G];if(M.utils.isUndefined(R)||M.utils.isUndefined(U)){var W=[],q=0;if(!M.utils.isNullOrEmpty(o)&&o.intersectsExtent(u)&&M.utils.isUndefined(R)&&(R=g,h[F]=R,q=1,W.push(F),g+=1,m+=1),!M.utils.isNullOrEmpty(S)&&M.utils.isUndefined(U)&&(U=d,b[G]=U,W.push(G),d+=1,0===q&&(m+=1,W.push(F))),void 0===R&&(R=0),void 0===U&&(U=0),p="\"[_gx_style ='".concat(R+U,"']\""),!M.utils.isNullOrEmpty(W)){var z="".concat(p,': {"symbolizers": [').concat(W,"]}");v+=""!==v?",".concat(z):"{".concat(z,',"version":"2"')}}(A="EPSG:3857"!==n.code&&t.facadeMap_.getLayers().some((function(e){return e.type===M.layer.type.OSM||e.type===M.layer.type.Mapbox}))?s.writeFeatureObject(e,{featureProjection:n.code,dataProjection:"EPSG:3857"}):s.writeFeatureObject(e)).properties={_gx_style:R+U,name:c},f.push(A)}}}),this),{type:"Vector",style:v=""!==v?JSON.parse(v.concat("}")):{"*":{symbolizers:[]},version:"2"},styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:f},name:r,opacity:l}}},{key:"encodeWMTS",value:function(e){var t=e.getImpl().getOL3Layer(),n=t.getSource(),i=e.url,o=e.name,r=t.getOpacity(),l=n.getRequestEncoding(),a=n.getMatrixSet();return e.getImpl().getCapabilities().then((function(e){var t=e.Contents.TileMatrixSet.filter((function(e){return e.Identifier===a}))[0];return{baseURL:i,imageFormat:"image/png",layer:o,matrices:t.TileMatrix.map((function(e,t){return{identifier:e.Identifier,matrixSize:[e.MatrixHeight,e.MatrixWidth],scaleDenominator:e.ScaleDenominator,tileSize:[e.TileWidth,e.TileHeight],topLeftCorner:e.TopLeftCorner}})),matrixSet:a,opacity:r,requestEncoding:l,style:"default",type:"WMTS",version:"1.0.0"}}))}},{key:"encodeOSM",value:function(e){var t=e.getImpl(),n=t.getOL3Layer(),i=n.getSource().getTileGrid(),o=e.url||"http://tile.openstreetmap.org/",r=e.name,l=n.getOpacity(),a=t.tiled,s=i.getExtent(),u=i.getTileSize();return{baseURL:o,opacity:l,singleTile:!a,layer:r,maxExtent:s,tileSize:[u,u],resolutions:i.getResolutions(),type:"OSM",extension:"png"}}},{key:"encodeMapbox",value:function(e){var t=e.getImpl().getOL3Layer(),n=t.getSource().getTileGrid(),i=M.utils.concatUrlPaths([M.config.MAPBOX_URL,e.name]),o=t.getOpacity(),r=n.getExtent(),l=n.getTileSize(),a=n.getResolutions(),s={};return s[M.config.MAPBOX_TOKEN_NAME]=M.config.MAPBOX_TOKEN_VALUE,{opacity:o,baseURL:i,customParams:s,maxExtent:r,tileSize:[l,l],resolutions:a,extension:M.config.MAPBOX_EXTENSION,type:"xyz",path_format:"/${z}/${x}/${y}.png"}}},{key:"reproject",value:function(e,t){var n=ol.proj.get(e),i=ol.proj.get("EPSG:4326");return ol.proj.transform(t,n,i)}},{key:"transformExt",value:function(e,t,n){return ol.proj.transformExtent(e,t,n)}},{key:"destroy",value:function(){this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null}}])&&o(n.prototype,i),s&&o(n,s),t}(),u=n(0),c=n.n(u);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=new s;return e=f(this,m(t).call(this,n,t.NAME)),M.utils.isUndefined(s)&&M.exception("La implementación usada no puede crear controles Printer"),M.utils.isUndefined(s.prototype.encodeLayer)&&M.exception("La implementación usada no posee el método encodeLayer"),e.serverUrl_="https://geoprint.desarrollo.guadaltel.es",e.printTemplateUrl_="https://geoprint.desarrollo.guadaltel.es/print/CNIG",e.printStatusUrl_="https://geoprint.desarrollo.guadaltel.es/print/status",e.inputTitle_=null,e.areaDescription_=null,e.layout_=null,e.format_=null,e.dpi_=null,e.forceScale_=null,e.params_={layout:{outputFilename:"mapa_${yyyy-MM-dd_hhmmss}"},pages:{clientLogo:"",creditos:"Impresión generada a través de Mapea"},parameters:{imageSpain:"file://E01_logo_IGN_CNIG.png",imageCoordinates:"file://E01_logo_IGN_CNIG.png"}},e.queueContainer_=null,e.capabilitiesPromise_=null,e.options_={dpi:150,forceScale:!1,format:"pdf",legend:"false",layout:"A4 horizontal"},e.layoutOptions_=[],e.dpisOptions_=[],e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,M.Control),n=t,(i=[{key:"getStatus",value:function(e,t){var n=this;M.remote.get(e).then((function(i){var o=JSON.parse(i.text),r=o.status;"finished"===r?t():"error"===r||"cancelled"===r?(t(),o.error.toLowerCase().indexOf("network is unreachable")>-1||o.error.toLowerCase().indexOf("illegalargument")>-1?M.dialog.error("La petición de alguna tesela ha provocado un error en la impresión. <br/>Por favor, inténtelo de nuevo."):M.dialog.error("Se ha producido un error en la impresión."),n.queueContainer_.lastChild.remove()):setTimeout((function(){return n.getStatus(e,t)}),1e3)}))}},{key:"createView",value:function(e){var t=this;return new Promise((function(e,n){t.getCapabilities().then((function(n){var i,o,r=n,l=0;for(l=0,i=r.layouts.length;l<i;l+=1){var a=r.layouts[l];if(a.name===t.options_.layout){a.default=!0;break}}for(r.layouts=r.layouts.filter((function(e){return!e.name.endsWith("jpg")})),t.layoutOptions_=[].concat(r.layouts.map((function(e){return e.name}))),r.dpis=[],l=0,i=r.layouts[0].attributes.length;l<i;l+=1)null!==r.layouts[0].attributes[l].clientInfo&&(o=r.layouts[0].attributes[l]);for(l=0,i=o.clientInfo.dpiSuggestions.length;l<i;l+=1){var s=o.clientInfo.dpiSuggestions[l];if(parseInt(s,10)===t.options_.dpi){s.default=!0;break}var u={value:s};r.dpis.push(u)}t.dpisOptions_=[].concat(r.dpis.map((function(e){return e.value}))),r.format=[{name:"pdf"},{name:"png"},{name:"jpg"}],r.forceScale=t.options_.forceScale;var p=M.template.compileSync(c.a,{jsonp:!0,vars:r});t.addEvents(p),e(p)}))}))}},{key:"addEvents",value:function(e){var t=this;this.element_=e,this.inputTitle_=this.element_.querySelector(".form div.title > input"),this.areaDescription_=this.element_.querySelector(".form div.description > textarea");var n=this.element_.querySelector(".form div.layout > select");n.addEventListener("change",(function(e){var i=n.value;t.setLayout({value:i,name:i})}));var i=n.value;this.setLayout({value:i,name:i});var o=this.element_.querySelector(".form div.dpi > select");o.addEventListener("change",(function(e){var n=o.value;t.setDpi({value:n,name:n})}));var r=o.value;this.setDpi({value:r,name:r});var l=this.element_.querySelector(".form div.format > select");l.addEventListener("change",(function(e){t.setFormat(l.value)})),this.setFormat(l.value);var a=this.element_.querySelector(".form div.forcescale > input");a.addEventListener("click",(function(e){t.setForceScale(a.checked)})),this.setForceScale(a.checked),this.element_.querySelector(".button > button.print").addEventListener("click",this.printClick_.bind(this)),this.element_.querySelector(".button > button.remove").addEventListener("click",(function(e){e.preventDefault(),t.inputTitle_.value="",t.areaDescription_.value="",n.value=t.layoutOptions_[0],o.value=t.dpisOptions_[0],l.value=t.options_.format,a.checked=t.options_.forceScale;var i=document.createEvent("HTMLEvents");i.initEvent("change");var r=document.createEvent("HTMLEvents");r.initEvent("click"),n.dispatchEvent(i),o.dispatchEvent(i),l.dispatchEvent(i),a.dispatchEvent(r),Array.prototype.forEach.apply(t.queueContainer_.children,[function(e){e.removeEventListener("click",t.downloadPrint)},t]),t.queueContainer_.innerHTML=""})),this.queueContainer_=this.element_.querySelector(".queue > ul.queue-container"),M.utils.enableTouchScroll(this.queueContainer_)}},{key:"setLayout",value:function(e){this.layout_=e}},{key:"setFormat",value:function(e){this.format_=e}},{key:"setDpi",value:function(e){this.dpi_=e}},{key:"setForceScale",value:function(e){this.forceScale_=e}},{key:"printClick_",value:function(e){var n=this;e.preventDefault(),this.getPrintData().then((function(e){var i=M.utils.concatUrlPaths([n.printTemplateUrl_,"report.".concat(e.outputFormat)]),o=n.createQueueElement();n.queueContainer_.appendChild(o),o.classList.add(t.LOADING_CLASS),i=M.utils.addParameters(i,"mapeaop=geoprint"),M.proxy(!1),M.remote.post(i,e).then((function(e){var i,r=e,l=JSON.parse(r.text).ref,a=M.utils.concatUrlPaths([n.printStatusUrl_,"".concat(l,".json")]);n.getStatus(a,(function(){return o.classList.remove(t.LOADING_CLASS)}));try{r=JSON.parse(r.text),i=M.utils.concatUrlPaths([n.serverUrl_,r.downloadURL])}catch(e){M.exception(e)}o.setAttribute(t.DOWNLOAD_ATTR_NAME,i),o.addEventListener("click",n.downloadPrint)})),M.proxy(!0)}))}},{key:"getCapabilities",value:function(){var e=this;return M.utils.isNullOrEmpty(this.capabilitiesPromise_)&&(this.capabilitiesPromise_=new Promise((function(t,n){var i=M.utils.concatUrlPaths([e.printTemplateUrl_,"capabilities.json"]);M.remote.get(i).then((function(e){var n={};try{n=JSON.parse(e.text)}catch(e){M.exception(e)}t(n)}))}))),this.capabilitiesPromise_}},{key:"converterDecimalToDMS",value:function(e){var t,n,i=e.toString().split(".");return t="".concat(i[0],"º "),n="0.".concat(i[1]),n=(n=(n*=60).toString()).split("."),t="".concat(t).concat(n[0],"' "),n="0.".concat(n[1]),n=(n=(n*=60).toString()).split("."),t="".concat(t).concat(n[0],"'' ")}},{key:"convertBboxToDMS",value:function(e){var t=this.map_.getProjection(),n=e;if("m"===t.units){var i=[e.x.min,e.y.min],o=[e.x.max,e.y.max],r=this.getImpl().reproject(t.code,i),l=this.getImpl().reproject(t.code,o);n={x:{min:r[0],max:l[0]},y:{min:r[1],max:l[1]}}}return n=this.convertDecimalBoxToDMS(n)}},{key:"convertDecimalBoxToDMS",value:function(e){return{x:{min:this.converterDecimalToDMS(e.x.min),max:this.converterDecimalToDMS(e.x.max)},y:{min:this.converterDecimalToDMS(e.y.min),max:this.converterDecimalToDMS(e.y.max)}}}},{key:"getPrintData",value:function(){var e=this,t=this.inputTitle_.value,n=this.areaDescription_.value,i=this.map_.getProjection().code,o=this.map_.getBbox(),r=this.convertBboxToDMS(o),l=this.layout_.name,a=this.dpi_.value,s=this.format_,u=this.map_.getCenter(),c=this.params_.parameters,p=document.querySelector("#m-attributions-container>div>a"),y=null!==p?"Cartografía base: ".concat(p.innerHTML):"";"jpg"===s&&(l+=" jpg");var f=new Date,m="".concat(f.getDate(),"/").concat(f.getMonth(),"/").concat(f.getFullYear()),d=M.utils.extend({layout:l,outputFormat:s,attributes:{title:t,description:n,attributionInfo:y,refsrs:this.turnProjIntoLegend(i),printDate:m,map:{dpi:a,projection:i,useAdjustBounds:!0},xCoordTopLeft:r.y.max,yCoordTopLeft:r.x.min,xCoordTopRight:r.y.max,yCoordTopRight:r.x.max,xCoordBotRight:r.y.min,yCoordBotRight:r.x.max,xCoordBotLeft:r.y.min,yCoordBotLeft:r.x.min}},this.params_.layout);return this.encodeLayers().then((function(t){return d.attributes.map.layers=t,d.attributes=Object.assign(d.attributes,c),"EPSG:3857"!==i.code&&e.map_.getLayers().some((function(e){return e.type===M.layer.type.OSM||e.type===M.layer.type.Mapbox}))&&(d.attributes.map.projection="EPSG:3857"),e.forceScale_?e.forceScale_&&(d.attributes.map.center=[u.x,u.y],d.attributes.map.scale=e.map_.getScale()):(d.attributes.map.bbox=[o.x.min,o.y.min,o.x.max,o.y.max],"EPSG:3857"!==i.code&&e.map_.getLayers().some((function(e){return e.type===M.layer.type.OSM||e.type===M.layer.type.Mapbox}))&&(d.attributes.map.bbox=e.getImpl().transformExt(d.attributes.map.bbox,i.code,"EPSG:3857"))),d}))}},{key:"encodeLayers",value:function(){var e=this,t=this.map_.getLayers().filter((function(e){return e.isVisible()&&e.inRange()&&"cluster_cover"!==e.name})),n=t.length;return new Promise((function(i,o){var r=[],l=[],a=[],s=[];t.forEach((function(t){e.getImpl().encodeLayer(t).then((function(e){M.utils.isNullOrEmpty(e)||("Vector"===e.type||"KML"===e.type?l.push(e):"WMS"===e.type?a.push(e):s.push(e)),0==(n-=1)&&(r=r.concat(s).concat(a).concat(l),i(r.reverse()))}))}))}))}},{key:"createQueueElement",value:function(){var e=document.createElement("li"),n=this.inputTitle_.value;return M.utils.isNullOrEmpty(n)&&(n=t.NO_TITLE),e.innerHTML=n,e}},{key:"downloadPrint",value:function(e){e.preventDefault();var n=this.getAttribute(t.DOWNLOAD_ATTR_NAME);M.utils.isNullOrEmpty(n)||window.open(n,"_blank")}},{key:"turnProjIntoLegend",value:function(e){var t;switch(e){case"EPSG:4258":t="ETRS89 (4258)";break;case"EPSG:4326":t="WGS84 (4326)";break;case"EPSG:3857":t="WGS84 (3857)";break;case"EPSG:25831":t="UTM zone 31N (25831)";break;case"EPSG:25830":t="UTM zone 30N (25830)";break;case"EPSG:25829":t="UTM zone 29N (25829)";break;case"EPSG:25828":t="UTM zone 28N (25828)";break;default:t=""}return t}},{key:"equals",value:function(e){var n=!1;return e instanceof t&&(n=this.name===e.name),n}}])&&y(n.prototype,i),o&&y(n,o),t}();function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function b(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t){return(O=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}g.NAME="printercontrol",g.TEMPLATE="printer.html",g.LOADING_CLASS="printing",g.DOWNLOAD_ATTR_NAME="data-donwload-url-print",g.NO_TITLE="(Sin título)";var S=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=b(this,_(t).call(this,null))).map_=null,e.controls_=[],e.control_=null,e.panel_=null,e.name=t.NAME,e.position_=n.position||"TR",e.collapsed_=n.collapsed,void 0===e.collapsed_&&(e.collapsed_=!0),e.collapsible_=n.collapsible,void 0===e.collapsible_&&(e.collapsible_=!0),e}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&O(e,t)}(t,M.Plugin),n=t,(i=[{key:"addTo",value:function(e){var t=this;this.map_=e,this.control_=new g,this.controls_.push(this.control_),this.panel_=new M.ui.Panel("printer",{collapsed:this.collapsed_,collapsible:this.collapsible_,className:"m-printer",collapsedButtonClass:"icon-impresora",position:M.ui.position[this.position_],tooltip:"Impresión del mapa"}),this.panel_.on(M.evt.ADDED_TO_MAP,(function(e){M.utils.enableTouchScroll(e)})),this.panel_.addControls(this.controls_),e.addPanels(this.panel_),this.control_.on(M.evt.ADDED_TO_MAP,(function(){t.fire(M.evt.ADDED_TO_MAP)}))}},{key:"getAPIRest",value:function(){return"".concat(this.name,"=").concat(this.position_,"*").concat(this.collapsed_,"*").concat(this.collapsible_)}},{key:"getControls",value:function(){return this.controls_}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_),this.map_=null,this.control_=null,this.controls_=null,this.panel_=null,this.name=null}},{key:"equals",value:function(e){return e instanceof t}}])&&h(n.prototype,i),o&&h(n,o),t}();S.NAME="printer",window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.Printer=S,window.M.control.PrinterControl=g,window.M.impl.control.PrinterControl=s}]);
//# sourceMappingURL=printer.ol.min.js.map