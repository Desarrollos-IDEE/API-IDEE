!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e){t.exports='<div class="m-control m-container m-printermap m-printermap-container">\n    \x3c!-- TITLE --\x3e\n    <div class="title">{{translations.tooltip}}</div>\n    \x3c!-- FORM --\x3e\n    <div class="form">\n        \x3c!-- title --\x3e\n        <div class="title">\n            <input type="text" placeholder="{{translations.title}}">\n        </div>\n        \x3c!-- description --\x3e\n        <div class="description">\n            <textarea placeholder="{{translations.description}}"></textarea>\n        </div>\n        \x3c!-- layout --\x3e\n        <div class="layout">\n            <label>{{translations.layout}} </label>\n            <select>\n                {{#each layouts}}\n                    <option value="{{name}}" {{#if default}} selected{{/if}}>{{name}}</option>\n                {{/each}}\n            </select>\n        </div>\n        \x3c!-- DPI --\x3e\n        <div class="dpi">\n            <label>DPI </label>\n            <select>\n                {{#each dpis}}\n                    <option value="{{value}}" {{#if default}} selected{{/if}}>{{value}}</option>\n                {{/each}}\n            </select>\n        </div>\n        \x3c!-- format --\x3e\n        <div class="format">\n            <label>{{translations.format}} </label>\n            <select>\n                {{#each format}}\n                    <option value="{{name}}" {{#if default}} selected{{/if}}>{{name}}</option>\n                {{/each}}\n            </select>\n        </div>\n        \x3c!-- force scale\n        <div class="forcescale">\n            <label>{{translations.force}} </label>\n            <input type="checkbox" {{#if forceScale}} checked{{/if}}>\n        </div> --\x3e\n    </div>\n    \x3c!-- buttons --\x3e\n    <div class="button">\n        <button class="print"><i class="icon-impresora"></i> {{translations.print}}</button>\n        <button class="remove"><i class="icon-papelera"></i> {{translations.delete}}</button>\n    </div>\n    \x3c!-- queue --\x3e\n    <div class="queue">\n        <div class="title">{{translations.download}}</div>\n        <ul class="queue-container"></ul>\n    </div>\n    \x3c!-- minimize button --\x3e\n    <div class="minimize" title="{{translations.minimize}}"></div>\n</div>\n'},function(t){t.exports=JSON.parse('{"exception":{"impl":"The implementation used cannot create PrinterMap.","encode":"The implementation used cannot use encodeLayer.","tile":"The request for some tile has caused a printing error. <br/>Please try again.","error":"An error has occurred while printing."},"tooltip":"Map Printing","credits":"Print generated through API-IGN","no_title":"(Untitled)","zone":"zone","base":"Base Cartography","title":"Title","description":"Description","layout":"Layout","format":"Format","force":"Force scale","print":"Print","delete":"Remove","download":"Download","minimize":"Minimize print control"}')},function(t){t.exports=JSON.parse('{"exception":{"impl":"La implementación usada no puede crear controles PrinterMap.","encode":"La implementación usada no posee el método encodeLayer.","tile":"La petición de alguna tesela ha provocado un error en la impresión. <br/>Por favor, inténtelo de nuevo.","error":"Se ha producido un error en la impresión."},"tooltip":"Impresión del mapa","credits":"Impresión generada a través del API-IGN","no_title":"(Sin título)","zone":"huso","base":"Cartografía base","title":"Título","description":"Descripción","layout":"Plantilla","format":"Formato","force":"Forzar escala","print":"Imprimir","delete":"Borrar","download":"Descargar","minimize":"Minimizar el control de impresión"}')},function(t,e,n){},function(t,e,n){"use strict";n.r(e);n(3);function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var s=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=o(this,a(e).call(this))).facadeMap_=null,t}var n,i,s;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(e,M.impl.Control),n=e,(i=[{key:"addTo",value:function(t,e){this.facadeMap_=t,ol.control.Control.call(this,{element:e,target:null}),t.getMapImpl().addControl(this)}},{key:"getParametrizedLayers",value:function(t,e){var n=this.facadeMap_.getMapImpl().getLayers().getArray().filter((function(e){return"IMAGE"===e.type&&!M.utils.isNullOrEmpty(e.getSource())&&!M.utils.isNullOrEmpty(e.getSource().getParams())&&void 0!==e.getSource().getParams()[t]}));return n=n.filter((function(t){return!e.some((function(e){return void 0!==e.url&&e.url===t.getSource().getUrl()}))}))}},{key:"encodeLayer",value:function(t){var e=this;return new Promise((function(n,i){t.type===M.layer.type.WMC||(t.type===M.layer.type.KML?n(e.encodeKML(t)):t.type===M.layer.type.WMS?n(e.encodeWMS(t)):t.type===M.layer.type.WFS?n(e.encodeWFS(t)):t.type===M.layer.type.GeoJSON?n(e.encodeWFS(t)):t.type===M.layer.type.WMTS?e.encodeWMTS(t).then((function(t){n(t)})):t.type===M.layer.type.MBtiles||(t.type===M.layer.type.OSM?n(e.encodeOSM(t)):t.type===M.layer.type.Mapbox?n(e.encodeMapbox(t)):M.utils.isNullOrEmpty(t.type)&&t instanceof M.layer.Vector?n(e.encodeWFS(t)):"IMAGE"!==t.type||t instanceof M.layer.WMS?n(e.encodeWFS(t)):n(e.encodeImage(t))))}))}},{key:"encodeKML",value:function(t){var e=t.getImpl().getOL3Layer(),n=e.getSource().getFeatures(),i=t.name,r=e.getOpacity(),o=new ol.format.GeoJSON,a=this.facadeMap_.getBbox();a=[a.x.min,a.y.min,a.x.max,a.y.max];var l,s,u=this.facadeMap_.getMapImpl().getView().getResolution(),c=[],p=1,y=1,m=1,f="",d={},g={};return n.forEach((function(t){var e=t.getGeometry(),n=t.get("styleUrl");M.utils.isNullOrEmpty(n)||(n=n.replace("#",""));var i=t.getStyle();if(!M.utils.isNullOrEmpty(i)){var r;try{r=i(t,u)[0]}catch(e){r=i.call(t,u)[0]}if(!M.utils.isNullOrEmpty(r)){var h,v=r.getImage(),b=v.getImageSize();M.utils.isNullOrEmpty(b)&&(b=[64,64]),h="multipolygon"===t.getGeometry().getType().toLowerCase()?"polygon":"multipoint"===t.getGeometry().getType().toLowerCase()?"point":t.getGeometry().getType().toLowerCase();var _,S=r.getStroke(),O={id:n,externalGraphic:v.getSrc(),graphicHeight:b[0],graphicWidth:b[1],graphicOpacity:v.getOpacity(),strokeWidth:S.getWidth(),type:h},x=r.getText&&r.getText();if(M.utils.isNullOrEmpty(x)||((_={conflictResolution:"false",fontColor:M.utils.isNullOrEmpty(x.getFill())?"":M.utils.rgbToHex(M.utils.isArray(x.getFill().getColor())?"rgba(".concat(x.getFill().getColor().toString(),")"):x.getFill().getColor()),fontSize:"11px",fontFamily:"Helvetica, sans-serif",fontWeight:"bold",label:M.utils.isNullOrEmpty(x.getText())?t.get("name"):x.getText(),labelAlign:x.getTextAlign(),labelXOffset:x.getOffsetX(),labelYOffset:x.getOffsetY(),labelOutlineColor:M.utils.isNullOrEmpty(x.getStroke())?"":M.utils.rgbToHex(M.utils.isArray(x.getStroke().getColor())?"rgba(".concat(x.getStroke().getColor().toString(),")"):x.getStroke().getColor()),labelOutlineWidth:M.utils.isNullOrEmpty(x.getStroke())?"":x.getStroke().getWidth(),type:"text"}).fontColor=_.fontColor.slice(0,7),_.labelOutlineColor=_.labelOutlineColor.slice(0,7)),l="draw".concat(m),!M.utils.isNullOrEmpty(e)&&e.intersectsExtent(a)||!M.utils.isNullOrEmpty(x)){var E=JSON.stringify(O),T=JSON.stringify(_),P=d[E],N=g[T];if(M.utils.isUndefined(P)||M.utils.isUndefined(N)){var L=[],w=0;if(!M.utils.isNullOrEmpty(e)&&e.intersectsExtent(a)&&M.utils.isUndefined(P)&&(P=y,d[E]=P,w=1,L.push(E),y+=1,m+=1),!M.utils.isNullOrEmpty(x)&&M.utils.isUndefined(N)&&(N=p,g[T]=N,L.push(T),p+=1,0===w&&(m+=1,L.push(E))),void 0===P&&(P=0),void 0===N&&(N=0),s="\"[_gx_style ='".concat(P+N,"']\""),!M.utils.isNullOrEmpty(L)){var C="".concat(s,': {"symbolizers": [').concat(L,"]}");f+=""!==f?",".concat(C):"{".concat(C,', "version": "2"')}}var k=o.writeFeatureObject(t);k.properties={name:l,_gx_style:P+N},c.push(k)}}}}),this),{type:"Vector",style:f=""!==f?JSON.parse(f.concat("}")):{"*":{symbolizers:[]},version:"2"},styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:c},name:i,opacity:r}}},{key:"encodeWMS",value:function(t){var e=null,n=t.getImpl().getOL3Layer(),i=t.url,r=n.getOpacity(),o=n.getSource().getParams(),a=[o.LAYERS],l=o.FORMAT,s=[o.STYLES];if(e={baseURL:i,opacity:r,type:"WMS",layers:a.join(",").split(","),format:l||"image/jpeg",styles:s.join(",").split(",")},t._updateNoCache){t._updateNoCache();var u=t.getNoCacheName(),c=t.getNoCacheUrl();M.utils.isNullOrEmpty(u)||M.utils.isNullOrEmpty(c)||(e.layers=[u],e.baseURL=c)}else{var p=t.getNoChacheName(),y=t.getNoChacheUrl();M.utils.isNullOrEmpty(p)||M.utils.isNullOrEmpty(y)||(e.layers=[p],e.baseURL=y)}return e.customParams={},Object.keys(o).forEach((function(t){-1!=="iswmc,transparent".indexOf(t.toLowerCase())&&(e.customParams[t]=o[t])})),e}},{key:"encodeImage",value:function(t){var e=null,n=t,i=n.getSource().getParams(),r=[i.LAYERS],o=[i.STYLES];return(e={baseURL:n.getSource().getUrl(),opacity:n.getOpacity(),type:"WMS",layers:r.join(",").split(","),format:i.FORMAT||"image/jpeg",styles:o.join(",").split(",")}).customParams={IMAGEID:i.IMAGEID,transparent:!0,iswmc:!1},e}},{key:"encodeWFS",value:function(t){var e=this,n=this.facadeMap_.getProjection(),i=t.getImpl().getOL3Layer(),r=i.getSource().getFeatures(),o=t.name,a=i.getOpacity(),l=i.getStyle(),s=new ol.format.GeoJSON,u=this.facadeMap_.getBbox();u=[u.x.min,u.y.min,u.x.max,u.y.max];var c,p,y=this.facadeMap_.getMapImpl().getView().getResolution(),m=[],f=1,d=1,g=1,h="",v={},b={};return r.forEach((function(t){var i,r=t.getGeometry(),o=t.getStyle();if(M.utils.isNullOrEmpty(o)?M.utils.isNullOrEmpty(l)||(i=l):i=o,i instanceof Function&&(i=i.call(i,t,y)),i instanceof Array&&(i=i.length>1&&!M.utils.isNullOrEmpty(i[1].getImage())&&i[1].getImage().getSrc?i[1]:i[0]),!M.utils.isNullOrEmpty(i)){var a,_=i.getImage(),S=M.utils.isNullOrEmpty(_)?[0,0]:_.getImageSize()||[24,24],O=i.getText();M.utils.isNullOrEmpty(O)&&!M.utils.isNullOrEmpty(i.textPath)&&(O=i.textPath),a="multipolygon"===t.getGeometry().getType().toLowerCase()?"polygon":"multipoint"===t.getGeometry().getType().toLowerCase()?"point":t.getGeometry().getType().toLowerCase().indexOf("linestring")>-1?"line":t.getGeometry().getType().toLowerCase();var x,E=M.utils.isNullOrEmpty(_)?i.getStroke():_.getStroke&&_.getStroke(),T=M.utils.isNullOrEmpty(_)?i.getFill():_.getFill&&_.getFill(),P={type:a,fillColor:M.utils.isNullOrEmpty(T)?"#000000":M.utils.rgbaToHex(T.getColor()).slice(0,7),fillOpacity:M.utils.isNullOrEmpty(T)?0:M.utils.getOpacityFromRgba(T.getColor()),strokeColor:M.utils.isNullOrEmpty(E)?"#000000":M.utils.rgbaToHex(E.getColor()),strokeOpacity:M.utils.isNullOrEmpty(E)?0:M.utils.getOpacityFromRgba(E.getColor()),strokeWidth:M.utils.isNullOrEmpty(E)?0:E.getWidth&&E.getWidth(),pointRadius:M.utils.isNullOrEmpty(_)?"":_.getRadius&&_.getRadius(),externalGraphic:M.utils.isNullOrEmpty(_)?"":_.getSrc&&_.getSrc(),graphicHeight:S[0],graphicWidth:S[1]};if(!M.utils.isNullOrEmpty(O)){var N=O.getTextAlign(),L=O.getTextBaseline(),w="";M.utils.isNullOrEmpty(N)||(N=N===M.style.align.LEFT?"l":N===M.style.align.RIGHT?"r":N===M.style.align.CENTER?"c":""),M.utils.isNullOrEmpty(L)||(L=L===M.style.baseline.BOTTOM?"b":L===M.style.baseline.MIDDLE?"m":L===M.style.baseline.TOP?"t":""),M.utils.isNullOrEmpty(N)||M.utils.isNullOrEmpty(L)||(w=N.concat(L));var C=O.getFont(),k=!M.utils.isNullOrEmpty(C)&&C.indexOf("bold")>-1?"bold":"normal",I="11px";if(!M.utils.isNullOrEmpty(C)){var j=C.substr(0,C.indexOf("px"));if(!M.utils.isNullOrEmpty(j)){var A=j.lastIndexOf(" ");I=A>-1?j.substr(A,j.length).trim().concat("px"):j.concat("px")}}x={type:"text",label:O.getText(),fontColor:M.utils.isNullOrEmpty(O.getFill())?"#000000":M.utils.rgbToHex(O.getFill().getColor()),fontSize:I,fontFamily:"Helvetica, sans-serif",fontStyle:"normal",fontWeight:k,conflictResolution:"false",labelXOffset:O.getOffsetX(),labelYOffset:O.getOffsetY(),fillColor:P.fillColor||"#FF0000",fillOpacity:P.fillOpacity||1,labelOutlineColor:M.utils.isNullOrEmpty(O.getStroke())?"":M.utils.rgbToHex(O.getStroke().getColor()||"#FF0000"),labelOutlineWidth:M.utils.isNullOrEmpty(O.getStroke())?"":O.getStroke().getWidth(),labelAlign:w}}if(c="draw".concat(f),!M.utils.isNullOrEmpty(r)&&r.intersectsExtent(u)||!M.utils.isNullOrEmpty(O)){var D,U=JSON.stringify(P),G=JSON.stringify(x),F=v[U],R=b[G];if(M.utils.isUndefined(F)||M.utils.isUndefined(R)){var W=[],z=0;if(!M.utils.isNullOrEmpty(r)&&r.intersectsExtent(u)&&M.utils.isUndefined(F)&&(F=g,v[U]=F,z=1,W.push(U),g+=1,f+=1),!M.utils.isNullOrEmpty(O)&&M.utils.isUndefined(R)&&(R=d,b[G]=R,W.push(G),d+=1,0===z&&(f+=1,W.push(U))),void 0===F&&(F=0),void 0===R&&(R=0),p="\"[_gx_style ='".concat(F+R,"']\""),!M.utils.isNullOrEmpty(W)){var q="".concat(p,': {"symbolizers": [').concat(W,"]}");h+=""!==h?",".concat(q):"{".concat(q,',"version":"2"')}}(D="EPSG:3857"!==n.code&&e.facadeMap_.getLayers().some((function(t){return t.type===M.layer.type.OSM||t.type===M.layer.type.Mapbox}))?s.writeFeatureObject(t,{featureProjection:n.code,dataProjection:"EPSG:3857"}):s.writeFeatureObject(t)).properties={_gx_style:F+R,name:c},m.push(D)}}}),this),{type:"Vector",style:h=""!==h?JSON.parse(h.concat("}")):{"*":{symbolizers:[]},version:"2"},styleProperty:"_gx_style",geoJson:{type:"FeatureCollection",features:m},name:o,opacity:a}}},{key:"encodeWMTS",value:function(t){var e=t.getImpl().getOL3Layer(),n=e.getSource(),i=t.url,r=t.name,o=e.getOpacity(),a=n.getRequestEncoding(),l=n.getMatrixSet();return t.getImpl().getCapabilities().then((function(e){var n=e.Contents.TileMatrixSet.filter((function(t){return t.Identifier===l}))[0];return{baseURL:i,imageFormat:t.options.imageFormat||"image/png",layer:r,matrices:n.TileMatrix.map((function(t,e){return{identifier:t.Identifier,matrixSize:[t.MatrixHeight,t.MatrixWidth],scaleDenominator:t.ScaleDenominator,tileSize:[t.TileWidth,t.TileHeight],topLeftCorner:t.TopLeftCorner}})),matrixSet:l,opacity:o,requestEncoding:a,style:"default",type:"WMTS",version:"1.0.0"}}))}},{key:"encodeOSM",value:function(t){var e=t.getImpl(),n=e.getOL3Layer(),i=n.getSource().getTileGrid(),r=t.url||"http://tile.openstreetmap.org/",o=t.name,a=n.getOpacity(),l=e.tiled,s=i.getExtent(),u=i.getTileSize();return{baseURL:r,opacity:a,singleTile:!l,layer:o,maxExtent:s,tileSize:[u,u],resolutions:i.getResolutions(),type:"OSM",extension:"png"}}},{key:"encodeMapbox",value:function(t){var e=t.getImpl().getOL3Layer(),n=e.getSource().getTileGrid(),i=M.utils.concatUrlPaths([M.config.MAPBOX_URL,t.name]),r=e.getOpacity(),o=n.getExtent(),a=n.getTileSize(),l=n.getResolutions(),s={};return s[M.config.MAPBOX_TOKEN_NAME]=M.config.MAPBOX_TOKEN_VALUE,{opacity:r,baseURL:i,customParams:s,maxExtent:o,tileSize:[a,a],resolutions:l,extension:M.config.MAPBOX_EXTENSION,type:"xyz",path_format:"/${z}/${x}/${y}.png"}}},{key:"reproject",value:function(t,e){var n=ol.proj.get(t),i=ol.proj.get("EPSG:4326");return ol.proj.transform(e,n,i)}},{key:"transformExt",value:function(t,e,n){return ol.proj.transformExtent(t,e,n)}},{key:"destroy",value:function(){this.facadeMap_.getMapImpl().removeControl(this),this.facadeMap_=null}}])&&r(n.prototype,i),s&&r(n,s),e}(),u=n(0),c=n.n(u),p={en:n(1),es:n(2)},y=function(){var t="es";return"function"==typeof M.language.getLang&&(t=M.language.getLang()),t},m=function(t){return p[t]},f=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y(),n=m(e),i="";return M.utils.isNullOrEmpty(n)?console.warn("The translation '".concat(e,"' has not been defined.")):i=t.split(".").reduce((function(t,e){return t[e]}),n),i};function d(t){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e){return!e||"object"!==d(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function b(t,e){return(b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _=function(t){function e(t,n,i,r){var o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var a=new s;return o=h(this,v(e).call(this,a,e.NAME)),M.utils.isUndefined(s)&&M.exception(f("exception.impl")),M.utils.isUndefined(s.prototype.encodeLayer)&&M.exception(f("exception.encode")),o.serverUrl_=t,o.printTemplateUrl_=n,o.printStatusUrl_=i,o.credits_=r,o.inputTitle_=null,o.areaDescription_=null,o.layout_=null,o.format_=null,o.dpi_=null,o.forceScale_=null,o.params_={layout:{outputFilename:"mapa_${yyyy-MM-dd_hhmmss}"},pages:{clientLogo:"",creditos:f("credits")},parameters:{imageSpain:"file://E01_logo_IGN_CNIG.png",imageCoordinates:"file://E01_logo_IGN_CNIG.png"}},o.queueContainer_=null,o.capabilitiesPromise_=null,o.options_={dpi:150,forceScale:!1,format:"pdf",legend:"false",layout:"A4 horizontal"},o.layoutOptions_=[],o.dpisOptions_=[],o.outputFormats_=["pdf","png","jpg"],o}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&b(t,e)}(e,M.Control),n=e,(i=[{key:"getStatus",value:function(t,e){var n=this;M.remote.get(t).then((function(i){var r=JSON.parse(i.text),o=r.status;"finished"===o?e():"error"===o||"cancelled"===o?(e(),r.error.toLowerCase().indexOf("network is unreachable")>-1||r.error.toLowerCase().indexOf("illegalargument")>-1?M.dialog.error(f("exception.tile")):M.dialog.error(f("exception.error")),n.queueContainer_.lastChild.remove()):setTimeout((function(){return n.getStatus(t,e)}),1e3)}))}},{key:"createView",value:function(t){var e=this;return new Promise((function(t,n){e.getCapabilities().then((function(n){var i,r,o=n,a=0;for(a=0,i=o.layouts.length;a<i;a+=1){var l=o.layouts[a];if(l.name===e.options_.layout){l.default=!0;break}}for(o.layouts=o.layouts.filter((function(t){return!t.name.endsWith("jpg")})),e.layoutOptions_=[].concat(o.layouts.map((function(t){return t.name}))),o.dpis=[],a=0,i=o.layouts[0].attributes.length;a<i;a+=1)null!==o.layouts[0].attributes[a].clientInfo&&(r=o.layouts[0].attributes[a]);for(a=0,i=r.clientInfo.dpiSuggestions.length;a<i;a+=1){var s=r.clientInfo.dpiSuggestions[a];if(parseInt(s,10)===e.options_.dpi){s.default=!0;break}var u={value:s};o.dpis.push(u)}e.dpisOptions_=[].concat(o.dpis.map((function(t){return t.value}))),Array.isArray(o.formats)&&(e.outputFormats_=o.formats),o.format=e.outputFormats_.map((function(t){return{name:t,default:"pdf"===t}})),o.forceScale=e.options_.forceScale,o.translations={tooltip:f("tooltip"),title:f("title"),description:f("description"),layout:f("layout"),format:f("format"),force:f("force"),print:f("print"),delete:f("delete"),download:f("download"),minimize:f("minimize")};var p=M.template.compileSync(c.a,{jsonp:!0,vars:o});e.addEvents(p),t(p)}))}))}},{key:"addEvents",value:function(t){var e=this;this.element_=t,this.inputTitle_=this.element_.querySelector(".form div.title > input"),this.areaDescription_=this.element_.querySelector(".form div.description > textarea");var n=this.element_.querySelector(".form div.layout > select");n.addEventListener("change",(function(t){var i=n.value;e.setLayout({value:i,name:i})}));var i=n.value;this.setLayout({value:i,name:i});var r=this.element_.querySelector(".form div.dpi > select");r.addEventListener("change",(function(t){var n=r.value;e.setDpi({value:n,name:n})}));var o=r.value;this.setDpi({value:o,name:o});var a=this.element_.querySelector(".form div.format > select");a.addEventListener("change",(function(t){e.setFormat(a.value)})),this.setFormat(a.value),this.element_.querySelector(".button > button.print").addEventListener("click",this.printClick_.bind(this)),this.element_.querySelector(".button > button.remove").addEventListener("click",(function(t){t.preventDefault(),e.inputTitle_.value="",e.areaDescription_.value="",n.value=e.layoutOptions_[0],r.value=e.dpisOptions_[0],a.value=e.options_.format;var i=document.createEvent("HTMLEvents");i.initEvent("change"),document.createEvent("HTMLEvents").initEvent("click"),n.dispatchEvent(i),r.dispatchEvent(i),a.dispatchEvent(i),Array.prototype.forEach.apply(e.queueContainer_.children,[function(t){t.removeEventListener("click",e.downloadPrint)},e]),e.queueContainer_.innerHTML=""})),this.queueContainer_=this.element_.querySelector(".queue > ul.queue-container"),M.utils.enableTouchScroll(this.queueContainer_)}},{key:"setLayout",value:function(t){this.layout_=t}},{key:"setFormat",value:function(t){this.format_=t}},{key:"setDpi",value:function(t){this.dpi_=t}},{key:"setForceScale",value:function(t){this.forceScale_=t}},{key:"printClick_",value:function(t){var n=this;t.preventDefault(),this.getPrintData().then((function(t){var i=M.utils.concatUrlPaths([n.printTemplateUrl_,"report.".concat(t.outputFormat)]),r=n.createQueueElement();n.queueContainer_.appendChild(r),r.classList.add(e.LOADING_CLASS),i=M.utils.addParameters(i,"mapeaop=geoprint"),M.proxy(!1),M.remote.post(i,t).then((function(t){var i,o=t,a=JSON.parse(o.text).ref,l=M.utils.concatUrlPaths([n.printStatusUrl_,"".concat(a,".json")]);n.getStatus(l,(function(){return r.classList.remove(e.LOADING_CLASS)}));try{if(o=JSON.parse(o.text),n.serverUrl_.endsWith("/geoprint")){var s=n.serverUrl_.substring(0,n.serverUrl_.lastIndexOf("/geoprint"));i=M.utils.concatUrlPaths([s,o.downloadURL])}else i=M.utils.concatUrlPaths([n.serverUrl_,o.downloadURL])}catch(t){M.exception(t)}r.setAttribute(e.DOWNLOAD_ATTR_NAME,i),r.addEventListener("click",n.downloadPrint)})),M.proxy(!0)}))}},{key:"getCapabilities",value:function(){var t=this;return M.utils.isNullOrEmpty(this.capabilitiesPromise_)&&(this.capabilitiesPromise_=new Promise((function(e,n){var i=M.utils.concatUrlPaths([t.printTemplateUrl_,"capabilities.json"]);M.remote.get(i).then((function(t){var n={};try{n=JSON.parse(t.text)}catch(t){M.exception(t)}e(n)}))}))),this.capabilitiesPromise_}},{key:"converterDecimalToDMS",value:function(t){var e,n,i=t.toString().split(".");return e="".concat(i[0],"º "),n="0.".concat(i[1]),n=(n=(n*=60).toString()).split("."),e="".concat(e).concat(n[0],"' "),n="0.".concat(n[1]),n=(n=(n*=60).toString()).split("."),e="".concat(e).concat(n[0],"'' ")}},{key:"convertBboxToDMS",value:function(t){var e=this.map_.getProjection(),n=t;if("m"===e.units){var i=[t.x.min,t.y.min],r=[t.x.max,t.y.max],o=this.getImpl().reproject(e.code,i),a=this.getImpl().reproject(e.code,r);n={x:{min:o[0],max:a[0]},y:{min:o[1],max:a[1]}}}return n=this.convertDecimalBoxToDMS(n)}},{key:"convertDecimalBoxToDMS",value:function(t){return{x:{min:this.converterDecimalToDMS(t.x.min),max:this.converterDecimalToDMS(t.x.max)},y:{min:this.converterDecimalToDMS(t.y.min),max:this.converterDecimalToDMS(t.y.max)}}}},{key:"getPrintData",value:function(){var t=this,e=this.inputTitle_.value,n=this.areaDescription_.value,i=this.credits_;i.length>2&&(n.length>0?n+=" - ".concat(i):n+=i);var r=this.map_.getProjection().code,o=this.map_.getBbox(),a=o,l=this.layout_.name,s=this.dpi_.value,u=this.format_,c=this.map_.getCenter(),p=this.params_.parameters,y=document.querySelector("#m-attributions-container>div>a"),m=null!==y?"".concat(f("base"),": ").concat(y.innerHTML):"";"jpg"===u&&(l+=" jpg");var d=new Date,g="".concat(d.getDate(),"/",d.getMonth()+1,"/",d.getFullYear()),h=e.replace(" ","");h.length<=8?(h=h.concat("${yyyyMMddhhmmss}"),this.params_.layout.outputFilename=h):(h=h.substring(0,7).concat("${yyyyMMddhhmmss}"),this.params_.layout.outputFilename=h);var v=M.utils.extend({layout:l,outputFormat:u,attributes:{title:e,description:n,attributionInfo:m,refsrs:this.turnProjIntoLegend(r),printDate:g,map:{dpi:s,projection:r,useAdjustBounds:!0},xCoordTopLeft:a.y.max,yCoordTopLeft:a.x.min,xCoordTopRight:a.y.max,yCoordTopRight:a.x.max,xCoordBotRight:a.y.min,yCoordBotRight:a.x.max,xCoordBotLeft:a.y.min,yCoordBotLeft:a.x.min}},this.params_.layout);return this.encodeLayers().then((function(e){return v.attributes.map.layers=e,v.attributes=Object.assign(v.attributes,p),"EPSG:3857"!==r&&t.map_.getLayers().some((function(t){return t.type===M.layer.type.OSM||t.type===M.layer.type.Mapbox}))&&(v.attributes.map.projection="EPSG:3857"),t.forceScale_?t.forceScale_&&(v.attributes.map.center=[c.x,c.y],v.attributes.map.scale=M.impl.utils.getWMTSScale(t.map_,!0)):(v.attributes.map.bbox=[o.x.min,o.y.min,o.x.max,o.y.max],"EPSG:3857"!==r&&t.map_.getLayers().some((function(t){return t.type===M.layer.type.OSM||t.type===M.layer.type.Mapbox}))&&(v.attributes.map.bbox=t.getImpl().transformExt(v.attributes.map.bbox,r,"EPSG:3857"))),v}))}},{key:"encodeLayers",value:function(){var t=this,e=this.map_.getLayers().filter((function(t){return t.isVisible()&&t.inRange()&&"cluster_cover"!==t.name})),n=e.length,i=this.getImpl().getParametrizedLayers("IMAGEID",e);return i.length>0&&(e=e.concat(i),n=e.length),new Promise((function(i,r){var o=[],a=[],l=[],s=[];e.forEach((function(e){t.getImpl().encodeLayer(e).then((function(t){M.utils.isNullOrEmpty(t)||("Vector"===t.type||"KML"===t.type?a.push(t):"WMS"===t.type?l.push(t):s.push(t)),0==(n-=1)&&(o=o.concat(s).concat(l).concat(a),i(o.reverse()))}))}))}))}},{key:"createQueueElement",value:function(){var t=document.createElement("li"),e=this.inputTitle_.value;return M.utils.isNullOrEmpty(e)&&(e=f("no_title")),t.innerHTML=e,t}},{key:"downloadPrint",value:function(t){t.preventDefault();var n=this.getAttribute(e.DOWNLOAD_ATTR_NAME);M.utils.isNullOrEmpty(n)||window.open(n,"_blank")}},{key:"turnProjIntoLegend",value:function(t){var e;switch(t){case"EPSG:4258":e="EPSG:4258 (ETRS89)";break;case"EPSG:4326":e="EPSG:4326 (WGS84)";break;case"EPSG:3857":e="EPSG:3857 (WGS84)";break;case"EPSG:25831":e="EPSG:25831 (UTM ".concat(f("zone")," 31N)");break;case"EPSG:25830":e="EPSG:25830 (UTM ".concat(f("zone")," 30N)");break;case"EPSG:25829":e="EPSG:25829 (UTM ".concat(f("zone")," 29N)");break;case"EPSG:25828":e="EPSG:25828 (UTM ".concat(f("zone")," 28N)");break;default:e=""}return e}},{key:"equals",value:function(t){var n=!1;return t instanceof e&&(n=this.name===t.name),n}}])&&g(n.prototype,i),r&&g(n,r),e}();function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function x(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function E(t){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function T(t,e){return(T=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}_.NAME="printermapcontrol",_.TEMPLATE="printermap.html",_.LOADING_CLASS="printing",_.DOWNLOAD_ATTR_NAME="data-donwload-url-print";var P=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=x(this,E(e).call(this,null))).map_=null,t.controls_=[],t.control_=null,t.panel_=null,t.name=e.NAME,t.position_=n.position||"TR",t.collapsed_=n.collapsed,void 0===t.collapsed_&&(t.collapsed_=!0),t.collapsible_=n.collapsible,void 0===t.collapsible_&&(t.collapsible_=!0),t.serverUrl_=n.serverUrl||M.config.GEOPRINT_URL,t.printTemplateUrl_=n.printTemplateUrl||M.config.PRINTERMAP_TEMPLATE,t.printStatusUrl_=n.printStatusUrl||M.config.GEOPRINT_STATUS,t.credits_=n.credits||"",t}var n,i,r;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&T(t,e)}(e,M.Plugin),n=e,(i=[{key:"addTo",value:function(t){var e=this;this.map_=t,this.control_=new _(this.serverUrl_,this.printTemplateUrl_,this.printStatusUrl_,this.credits_),this.controls_.push(this.control_),this.panel_=new M.ui.Panel("printermap",{collapsed:this.collapsed_,collapsible:this.collapsible_,className:"m-printermap",collapsedButtonClass:"icon-impresora",position:M.ui.position[this.position_],tooltip:f("tooltip")}),this.panel_.on(M.evt.ADDED_TO_MAP,(function(t){M.utils.enableTouchScroll(t)})),this.panel_.addControls(this.controls_),t.addPanels(this.panel_),this.control_.on(M.evt.ADDED_TO_MAP,(function(){e.fire(M.evt.ADDED_TO_MAP)}))}},{key:"getAPIRest",value:function(){return"".concat(this.name,"=").concat(this.position_,"*").concat(this.collapsed_,"*").concat(this.collapsible_,"*").concat(this.serverUrl_,"*").concat(this.printTemplateUrl_,"*").concat(this.printStatusUrl_)}},{key:"getControls",value:function(){return this.controls_}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_),this.map_=null,this.control_=null,this.controls_=null,this.panel_=null,this.name=null}},{key:"equals",value:function(t){return t instanceof e}}])&&O(n.prototype,i),r&&O(n,r),e}();P.NAME="printermap",window.M.plugin||(window.M.plugin={}),window.M.control||(window.M.control={}),window.M.impl||(window.M.impl={}),window.M.impl.control||(window.M.impl.control={}),window.M.plugin.PrinterMap=P,window.M.control.PrinterMapControl=_,window.M.impl.control.PrinterMapControl=s}]);
//# sourceMappingURL=printermap.ol.min.js.map