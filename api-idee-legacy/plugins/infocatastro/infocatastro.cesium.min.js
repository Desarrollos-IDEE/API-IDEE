(()=>{var t={819:()=>{},843:t=>{t.exports='<div class="m-control m-container m-infocatastro-container">\n    <button id=\'m-infocatastro-btn\' class="m-infocatastro-btn icon-posicion4" title="{{translations.consultar}}"></button>\n</div>'}},e={};function o(n){var r=e[n];if(void 0!==r)return r.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,o),a.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=o(819),e=o.n(t),n=o(843),r=o.n(n);const a=JSON.parse('{"tooltip":"Cadastre information","informacionCatastral":"Cadastre information","errorConexion":"It is not possible to establish a connection with the Cadastre server.","consultar":"Cadastre information","infocatastro_obsolete":"Message to the developer: IDEE.plugin.InfoCatastro has been deprecated, please use IDEE.plugin.Locator instead","description":"Description","reference":"Cadastral reference","noReference":"No reference","noInfo":"NO REFERENCES AVAILABLE FOR THESE COORDINATES ","exception":{"impl":"The implementation used cannot create InfoCatastro controls."}}'),i=JSON.parse('{"tooltip":"Consultar Catastro","informacionCatastral":"Información catastral","errorConexion":"No es posible establecer conexión con el servidor de Catastro.","consultar":"Consultar Catastro","infocatastro_obsolete":"Mensaje para el desarrollador: IDEE.plugin.InfoCatastro ha quedado obsoleto, utilice en su lugar IDEE.plugin.Locator","description":"Descripción","reference":"Referencia catastral","noReference":"No hay referencia","noInfo":"PARA ESAS COORDENADAS NO HAY REFERENCIA DISPONIBLE","exception":{"impl":"La implementación no puede crear controles de InfoCatastro."}}');var c={en:a,es:i},s=function(t){var e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e="es","function"==typeof IDEE.language.getLang&&(e=IDEE.language.getLang()),e),n=function(t){return"es"===t||"en"===t?c[t]:IDEE.language.getTranslation(t).infocatastro}(o),r="";return IDEE.utils.isNullOrEmpty(n)?console.warn("The translation '".concat(o,"' has not been defined.")):r=t.split(".").reduce((function(t,e){return t[e]}),n),r};function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function u(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,f(n.key),n)}}function f(t){var e=function(t,e){if("object"!=l(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==l(e)?e:e+""}function p(t,e,o){return e=y(e),function(t,e){if(e&&("object"==l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,d()?Reflect.construct(e,o||[],y(t).constructor):e.apply(t,o))}function d(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(d=function(){return!!t})()}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},y(t)}function b(t,e){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},b(t,e)}var E=function(){function t(o){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(IDEE.utils.isUndefined(e())||IDEE.utils.isObject(e())&&IDEE.utils.isNullOrEmpty(Object.keys(e())))&&IDEE.exception(s("exception.impl")),(n=p(this,t,[new(e()),"InfoCatastro"])).facadeMap_=null,n.element_=null,n.catastroWMS=o.url,n.tooltip=o.tooltip,n.POPUP_TITLE=s("informacionCatastral"),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&b(t,e)}(t,IDEE.Control),o=t,n=[{key:"createView",value:function(t){var e=this;return this.facadeMap_=t,console.warn(s("infocatastro_obsolete")),new Promise((function(t,o){var n=IDEE.template.compileSync(r(),{vars:{translations:{consultar:e.tooltip||s("consultar")}}});e.element_=n,e.element_.querySelector("#m-infocatastro-btn").addEventListener("click",e.activate.bind(e)),t(n)}))}},{key:"activate",value:function(){this.activated?this.deactivate():(this.facadeMap_.on(IDEE.evt.CLICK,this.buildUrl_,this),this.activated=!0,this.element_.querySelector("#m-infocatastro-btn").classList.add("activated"),document.addEventListener("keydown",this.checkEscKey.bind(this)))}},{key:"checkEscKey",value:function(t){"Escape"===t.key&&(this.deactivate(),document.removeEventListener("keydown",this.checkEscKey))}},{key:"deactivate",value:function(){this.facadeMap_.removePopup(),this.facadeMap_.un(IDEE.evt.CLICK,this.buildUrl_,this),this.activated=!1,this.element_.querySelector("#m-infocatastro-btn").classList.remove("activated")}},{key:"buildUrl_",value:function(t){var e=this,o=this.facadeMap_.getProjection().code;IDEE.remote.get(this.catastroWMS,{SRS:o,Coordenada_X:t.coord[0],Coordenada_Y:t.coord[1]}).then((function(o){e.showInfoFromURL_(o,t.coord)}),{jsonp:!0})}},{key:"showInfoFromURL_",value:function(t,e){var o=this;if(200===t.code&&!1===t.error){var n=[],r=t.text,a=this.formatInfo_(r);n.push(a);var i={icon:"g-cartografia-pin",title:this.POPUP_TITLE,content:n.join("")},c=this.facadeMap_.getPopup();if(IDEE.utils.isNullOrEmpty(c))(c=new IDEE.Popup).addTab(i),this.facadeMap_.addPopup(c,e);else if(c.getCoordinate()[0]===e[0]&&c.getCoordinate()[1]===e[1]){var l=!1;c.getTabs().forEach((function(t){t.title!==o.POPUP_TITLE?l=!0:c.removeTab(t)})),l?c.addTab(i):((c=new IDEE.Popup).addTab(i),this.facadeMap_.addPopup(c,e))}else(c=new IDEE.Popup).addTab(i),this.facadeMap_.addPopup(c,e)}else this.facadeMap_.removePopup(),IDEE.dialog.error(s("errorConexion"))}},{key:"formatInfo_",value:function(t){var e,o,n,r,a="",i=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("consulta_coordenadas")[0];if("1"===i.getElementsByTagName("control")[0].getElementsByTagName("cuerr")[0].childNodes[0].nodeValue)o=s("noInfo");else{var c=i.getElementsByTagName("coordenadas")[0].getElementsByTagName("coord")[0],l=c.getElementsByTagName("pc")[0],u=l.getElementsByTagName("pc1")[0].childNodes[0].nodeValue,f=l.getElementsByTagName("pc2")[0].childNodes[0].nodeValue;n=u.substring(0,2),r=u.substring(2,5),e=c.getElementsByTagName("ldt")[0].childNodes[0].nodeValue,o=u+f,a="https://www1.sedecatastro.gob.es/CYCBienInmueble/OVCListaBienes.aspx?del==".concat(n,"&mun=").concat(r,"&rc1=").concat(u,"&rc2=").concat(f)}var p="".concat(IDEE.utils.beautifyAttribute(s("informacionCatastral")),"\n    <div class='divinfo'>\n    <table class='api-idee-table'>\n    <tbody>\n    <tr><td class='header' colspan='4'></td></tr>\n    <tr><td class='key'><b>").concat(IDEE.utils.beautifyAttribute(s("reference")),"</b></td><td class='value'></b>\n    <a href='").concat(a,"' target='_blank'>").concat(o,"</a></td></tr>\n    <tr><td class='key'><b>").concat(IDEE.utils.beautifyAttribute(s("description")),"</b></td>\n    <td class='value'>").concat(e,"</td></tr>\n    </tbody></table></div>");return o.toLowerCase().indexOf(s("noReference"))>-1&&(p="".concat(IDEE.utils.beautifyAttribute(s("informacionCatastral")),"\n      <div class='divinfo'>\n      <table class='api-idee-table'>\n      <tbody>\n      <tr><td class='header' colspan='4'></td></tr>\n      <tr><td class='key' colspan='4'><b>").concat(o,"</b></td></tr>\n      </tbody></table>\n      </div>")),p}},{key:"equals",value:function(e){return e instanceof t}}],n&&u(o.prototype,n),a&&u(o,a),Object.defineProperty(o,"prototype",{writable:!1}),o;var o,n,a}();const m=JSON.parse('{"Pu":{"name":"InfoCatastro","description":"Muestra referencia catastral para un punto y provee de enlace a la información de la DGC","text":"Búsqueda catastral mediante click","version":"2.0.2","date":"09/12/2019","author":"Guadaltel","org":"CNIG","tags":"api-idee,plugin","icon":"./facade/assets/icons/icon.svg"}}');function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function h(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,g(n.key),n)}}function g(t){var e=function(t,e){if("object"!=v(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!=v(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==v(e)?e:e+""}function _(t,e,o){return e=w(e),function(t,e){if(e&&("object"==v(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,I()?Reflect.construct(e,o||[],w(t).constructor):e.apply(t,o))}function I(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(I=function(){return!!t})()}function w(t){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},w(t)}function O(t,e){return O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},O(t,e)}var C=function(){function t(e){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(o=_(this,t)).map_=null,o.controls_=[],o.position_=e.position||"TR",o.tooltip_=e.tooltip||s("tooltip"),o.catastroWMS=e.catastroWMS||"http://ovc.catastro.meh.es/ovcservweb/OVCSWLocalizacionRC/OVCCoordenadas.asmx/Consulta_RCCOOR",o.metadata_=m.Pu,o.name_="infocatastro",o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&O(t,e)}(t,IDEE.Plugin),e=t,n=[{key:"getJSONTranslations",value:function(t){return"en"===t||"es"===t?"en"===t?a:i:IDEE.language.getTranslation(t).infocatastro}}],(o=[{key:"addTo",value:function(t){this.controls_.push(new E({url:this.catastroWMS,tooltip:this.tooltip_})),this.map_=t,this.panel_=new IDEE.ui.Panel("panelInfoCatastro",{className:"m-plugin-catastro",position:IDEE.ui.position[this.position_],tooltip:this.tooltip_,collapsedButtonClass:"icon-posicion4"}),this.panel_.addControls(this.controls_),t.addPanels(this.panel_);var e=this;this.controls_[0].on(IDEE.evt.ADDED_TO_MAP,(function(){e.fire(IDEE.evt.ADDED_TO_MAP)}))}},{key:"name",get:function(){return"infocatastro"}},{key:"position",get:function(){return this.position_}},{key:"getAPIRest",value:function(){return"".concat(this.name_,"=").concat(this.position_,"*").concat(this.tooltip_,"*").concat(this.catastroWMS)}},{key:"equals",value:function(e){return e instanceof t}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_);var t=[null,null,null];this.map_=t[0],this.controls_=t[1],this.panel_=t[2]}}])&&h(e.prototype,o),n&&h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,o,n}();window.IDEE.plugin||(window.IDEE.plugin={}),window.IDEE.control||(window.IDEE.control={}),window.IDEE.impl||(window.IDEE.impl={}),window.IDEE.impl.control||(window.IDEE.impl.control={}),window.IDEE.plugin.InfoCatastro=C,window.IDEE.control.InfoCatastroControl=E,window.IDEE.impl.control.InfoCatastroControl=e()})()})();
//# sourceMappingURL=infocatastro.cesium.min.js.map