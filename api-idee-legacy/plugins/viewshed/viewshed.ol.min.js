(()=>{var e={231:e=>{e.exports='<div class="m-control m-container m-viewshed-container">\n    <button id=\'m-viewshed-calculate-btn\' class="m-viewshed-btn icon-pin" title="{{translations.active_viewshed}}"></button>\n    <button id=\'m-viewshed-clear-btn\' class="m-viewshed-btn icon-clear" title="{{translations.clear}}"></button>\n</div>\n'}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function o(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var r=o.call(t,n||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}function r(t,n,o){return n=c(n),function(t,n){if(n&&("object"==e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(t,i()?Reflect.construct(n,o||[],c(t).constructor):n.apply(t,o))}function i(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(i=function(){return!!e})()}function a(){return a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var o=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}},a.apply(null,arguments)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}var u=function(){function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r(this,e,arguments)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(e,IDEE.impl.Control),n=e,o=[{key:"addTo",value:function(t,n){var o,r,i,l,u;this.facadeMap_=t,(o=e,r="addTo",i=this,u=a(c(1&(l=3)?o.prototype:o),r,i),2&l&&"function"==typeof u?function(e){return u.apply(i,e)}:u)([t,n])}},{key:"transformCoordinates",value:function(e,t){return ol.proj.transform(e,this.facadeMap_.getProjection().code,t)}},{key:"loadGeoJSONLayer",value:function(e,t){var n=(new ol.format.GeoJSON).readFeatures(e,{featureProjection:this.facadeMap_.getProjection().code});n=this.featuresToFacade(n);var o=new IDEE.Feature("clickedPoint",{type:"Feature",id:"clickedPoint",geometry:{type:"Point",coordinates:t}}),r=new IDEE.layer.Vector({name:"viewresult",legend:"viewresult",extract:!1});return r.addFeatures(n),r.addFeatures([o]),this.facadeMap_.addLayers(r),o.setStyle(new IDEE.style.Point({radius:7,fill:{color:"red"},stroke:{color:"white",width:2}})),n.forEach((function(e){e.setStyle(new IDEE.style.Polygon({fill:{color:"#71a7d3",opacity:.5},stroke:{color:"#71a7d3",width:2}}))})),n}},{key:"featuresToFacade",value:function(e){return e.map((function(e){return IDEE.impl.Feature.feature2Facade(e)}))}},{key:"centerFeatures",value:function(e){if(!IDEE.utils.isNullOrEmpty(e))if(1===e.length&&"Point"===e[0].getGeometry().type){var t=new ol.View({center:e[0].getGeometry().coordinates,zoom:15});this.facadeMap_.getMapImpl().setView(t)}else{var n=IDEE.impl.utils.getFeaturesExtent(e);this.facadeMap_.getMapImpl().getView().fit(n,{duration:500,minResolution:1})}}}],o&&t(n.prototype,o),i&&t(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,i}(),s=n(231),p=n.n(s);const d=JSON.parse('{"exception":{"impl":"The implementation used cannot create Viewshed controls."},"tooltip":"Calculate visibility area","calculating":"Performing geoprocessing analysis","warning":"Warning","outbox":"he coordinates are not within the calculation range","error_query":"Unable to perform query","active_viewshed":"Click a point on the map","clear":"Clean result"}'),f=JSON.parse('{"exception":{"impl":"La implementación no puede crear controles de ViewShed."},"tooltip":"Calcular área de visibilidad","calculating":"Realizando geoproceso de análisis","warning":"Advertencia","outbox":"Las coordenadas no están dentro del ámbito de cálculo","error_query":"No se ha podido realizar la consulta","active_viewshed":"Hacer click en punto del mapa","clear":"Limpiar resultado"}');var y={en:d,es:f},v=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t="es","function"==typeof IDEE.language.getLang&&(t=IDEE.language.getLang()),t),o=function(e){return"es"===e||"en"===e?y[e]:IDEE.language.getTranslation(e).viewshed}(n),r="";return IDEE.utils.isNullOrEmpty(o)?console.warn("The translation '".concat(n,"' has not been defined.")):r=e.split(".").reduce((function(e,t){return e[t]}),o),r};function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function b(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,h(o.key),o)}}function h(e){var t=function(e,t){if("object"!=m(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=m(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==m(t)?t:t+""}function w(e,t,n){return t=g(t),function(e,t){if(t&&("object"==m(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,E()?Reflect.construct(t,n||[],g(e).constructor):t.apply(e,n))}function E(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(E=function(){return!!e})()}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}var O=function(){function e(t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(IDEE.utils.isUndefined(u)||IDEE.utils.isObject(u)&&IDEE.utils.isNullOrEmpty(Object.keys(u)))&&IDEE.exception(v("exception.impl")),(n=w(this,e,[new u,"ViewShed"])).facadeMap_=null,n.element_=null,n.url_=t.url,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}(e,IDEE.Control),t=e,(n=[{key:"createView",value:function(e){var t=this;return this.facadeMap_=e,new Promise((function(e,n){var o=IDEE.template.compileSync(p(),{vars:{translations:{tooltip:v("tooltip"),active_viewshed:v("active_viewshed"),clear:v("clear")}}});t.element_=o,o.querySelector("#m-viewshed-clear-btn").addEventListener("click",t.clear.bind(t)),o.querySelector("#m-viewshed-calculate-btn").addEventListener("click",t.activate.bind(t)),e(o)}))}},{key:"activate",value:function(){this.activated?this.deactivate():(this.facadeMap_.on(IDEE.evt.CLICK,this.analizeVisibility,this),this.activated=!0,this.element_.querySelector("#m-viewshed-calculate-btn").classList.add("activated"),document.addEventListener("keydown",this.checkEscKey.bind(this)))}},{key:"checkEscKey",value:function(e){"Escape"===e.key&&(this.deactivate(),document.removeEventListener("keydown",this.checkEscKey))}},{key:"deactivate",value:function(){this.facadeMap_.removePopup(),this.facadeMap_.un(IDEE.evt.CLICK,this.analizeVisibility,this),this.activated=!1,this.element_.querySelector("#m-viewshed-calculate-btn").classList.remove("activated")}},{key:"analizeVisibility",value:function(e){var t=this,n=this.facadeMap_.getLayers().filter((function(e){return"Vector"===e.type&&"viewresult"===e.name}));this.facadeMap_.removeLayers(n);var o=this.getImpl().transformCoordinates(e.coord,"EPSG:4326"),r='<div class="m-viewshed-message">'.concat(v("calculating"),'...<br/><br/><p class="m-viewshed-loading"><span class="icon-spinner" /></p></div>');IDEE.dialog.info(r),setTimeout((function(){document.querySelector("div.m-api-idee-container div.m-dialog div.m-title").style.backgroundColor="#71a7d3",document.querySelector("div.m-dialog.info div.m-button > button").remove()}),10),IDEE.remote.get("".concat(this.url_,"/api/operations/checkCoordinates?x=").concat(o[0],"&y=").concat(o[1])).then((function(n){if(!0===JSON.parse(n.text).valid){var r="".concat(t.url_,"/api/operations/viewshed?x=").concat(o[0],"&y=").concat(o[1],"&distance=0.1");IDEE.remote.get(r).then((function(n){document.querySelector("div.m-api-idee-container div.m-dialog").remove();var o=t.getImpl().loadGeoJSONLayer(n.text,e.coord);t.getImpl().centerFeatures(o)})).catch((function(e){document.querySelector("div.m-api-idee-container div.m-dialog").remove(),IDEE.dialog.error(v("error_query"))}))}else document.querySelector("div.m-api-idee-container div.m-dialog").remove(),IDEE.dialog.error(v("outbox"),v("warning"))})).catch((function(e){document.querySelector("div.m-api-idee-container div.m-dialog").remove(),IDEE.dialog.error(v("error_query"))}))}},{key:"clear",value:function(){var e=this.facadeMap_.getLayers().filter((function(e){return"Vector"===e.type&&"viewresult"===e.name}));this.facadeMap_.removeLayers(e),this.deactivate()}},{key:"equals",value:function(t){return t instanceof e}}])&&b(t.prototype,n),o&&b(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}();const P=JSON.parse('{"Pu":{"name":"ViewShed","description":"Muestra el área visible calculada a partir de un punto con un análisis de visibilidad.","text":"Muestra área visible mediante análisis de visibilidad a partir de un click","version":"2.0.2","date":"12/07/2020","author":"Guadaltel","org":"CNIG","tags":"api-idee,plugin","icon":"./facade/assets/icons/icon.svg"}}');function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}function S(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,I(o.key),o)}}function I(e){var t=function(e,t){if("object"!=D(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=D(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==D(t)?t:t+""}function j(e,t,n){return t=T(t),function(e,t){if(t&&("object"==D(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,k()?Reflect.construct(t,n||[],T(e).constructor):t.apply(e,n))}function k(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(k=function(){return!!e})()}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}function C(e,t){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},C(e,t)}var M=function(){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(t=j(this,e)).map_=null,t.controls_=[],t.position_=n.position||"TL",t.collapsed_=n.collapsed,void 0===t.collapsed_&&(t.collapsed_=!0),t.collapsible_=n.collapsible,void 0===t.collapsible_&&(t.collapsible_=!0),t.url_=n.url||"https://componentes-desarrollo.idee.es/geoprocess-services",t.metadata_=P.Pu,t.name_="viewshed",t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&C(e,t)}(e,IDEE.Plugin),t=e,o=[{key:"getJSONTranslations",value:function(e){return"en"===e||"es"===e?"en"===e?d:f:IDEE.language.getTranslation(e).viewshed}}],(n=[{key:"addTo",value:function(e){this.controls_.push(new O({url:this.url_})),this.map_=e,this.panel_=new IDEE.ui.Panel("panelViewShed",{className:"m-viewshed-container",collapsed:this.collapsed_,collapsible:this.collapsible_,position:IDEE.ui.position[this.position_],tooltip:v("tooltip"),collapsedButtonClass:"icon-viewshed"}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_);var t=this;this.controls_[0].on(IDEE.evt.ADDED_TO_MAP,(function(){t.fire(IDEE.evt.ADDED_TO_MAP)}))}},{key:"name",get:function(){return"viewshed"}},{key:"position",get:function(){return this.position_}},{key:"getAPIRest",value:function(){return"".concat(this.name_,"=").concat(this.position_)}},{key:"equals",value:function(t){return t instanceof e}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_);var e=[null,null,null];this.map_=e[0],this.controls_=e[1],this.panel_=e[2]}}])&&S(t.prototype,n),o&&S(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}();window.IDEE.plugin||(window.IDEE.plugin={}),window.IDEE.control||(window.IDEE.control={}),window.IDEE.impl||(window.IDEE.impl={}),window.IDEE.impl.control||(window.IDEE.impl.control={}),window.IDEE.plugin.ViewShed=M,window.IDEE.control.ViewShedControl=O,window.IDEE.impl.control.ViewShedControl=u})()})();
//# sourceMappingURL=viewshed.ol.min.js.map