(()=>{var e={186:()=>{},231:e=>{e.exports='<div class="m-control m-container m-viewshed-container">\n    <button id=\'m-viewshed-calculate-btn\' class="m-viewshed-btn icon-pin" title="{{translations.active_viewshed}}"></button>\n    <button id=\'m-viewshed-clear-btn\' class="m-viewshed-btn icon-clear" title="{{translations.clear}}"></button>\n</div>\n'}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(186),t=n.n(e),o=n(231),i=n.n(o);const r=JSON.parse('{"exception":{"impl":"The implementation used cannot create Viewshed controls."},"tooltip":"Calculate visibility area","calculating":"Performing geoprocessing analysis","warning":"Warning","outbox":"he coordinates are not within the calculation range","error_query":"Unable to perform query","active_viewshed":"Click a point on the map","clear":"Clean result"}'),a=JSON.parse('{"exception":{"impl":"La implementación no puede crear controles de ViewShed."},"tooltip":"Calcular área de visibilidad","calculating":"Realizando geoproceso de análisis","warning":"Advertencia","outbox":"Las coordenadas no están dentro del ámbito de cálculo","error_query":"No se ha podido realizar la consulta","active_viewshed":"Hacer click en punto del mapa","clear":"Limpiar resultado"}');var c={en:r,es:a},l=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(t="es","function"==typeof IDEE.language.getLang&&(t=IDEE.language.getLang()),t),o=function(e){return"es"===e||"en"===e?c[e]:IDEE.language.getTranslation(e).viewshed}(n),i="";return IDEE.utils.isNullOrEmpty(o)?console.warn("The translation '".concat(n,"' has not been defined.")):i=e.split(".").reduce((function(e,t){return e[t]}),o),i};function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,d(o.key),o)}}function d(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=s(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==s(t)?t:t+""}function p(e,t,n){return t=v(t),function(e,t){if(t&&("object"==s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,f()?Reflect.construct(t,n||[],v(e).constructor):t.apply(e,n))}function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(f=function(){return!!e})()}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}var m=function(){function e(n){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(IDEE.utils.isUndefined(t())||IDEE.utils.isObject(t())&&IDEE.utils.isNullOrEmpty(Object.keys(t())))&&IDEE.exception(l("exception.impl")),(o=p(this,e,[new(t()),"ViewShed"])).facadeMap_=null,o.element_=null,o.url_=n.url,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}(e,IDEE.Control),n=e,(o=[{key:"createView",value:function(e){var t=this;return this.facadeMap_=e,new Promise((function(e,n){var o=IDEE.template.compileSync(i(),{vars:{translations:{tooltip:l("tooltip"),active_viewshed:l("active_viewshed"),clear:l("clear")}}});t.element_=o,o.querySelector("#m-viewshed-clear-btn").addEventListener("click",t.clear.bind(t)),o.querySelector("#m-viewshed-calculate-btn").addEventListener("click",t.activate.bind(t)),e(o)}))}},{key:"activate",value:function(){this.activated?this.deactivate():(this.facadeMap_.on(IDEE.evt.CLICK,this.analizeVisibility,this),this.activated=!0,this.element_.querySelector("#m-viewshed-calculate-btn").classList.add("activated"),document.addEventListener("keydown",this.checkEscKey.bind(this)))}},{key:"checkEscKey",value:function(e){"Escape"===e.key&&(this.deactivate(),document.removeEventListener("keydown",this.checkEscKey))}},{key:"deactivate",value:function(){this.facadeMap_.removePopup(),this.facadeMap_.un(IDEE.evt.CLICK,this.analizeVisibility,this),this.activated=!1,this.element_.querySelector("#m-viewshed-calculate-btn").classList.remove("activated")}},{key:"analizeVisibility",value:function(e){var t=this,n=this.facadeMap_.getLayers().filter((function(e){return"Vector"===e.type&&"viewresult"===e.name}));this.facadeMap_.removeLayers(n);var o=this.getImpl().transformCoordinates(e.coord,"EPSG:4326"),i='<div class="m-viewshed-message">'.concat(l("calculating"),'...<br/><br/><p class="m-viewshed-loading"><span class="icon-spinner" /></p></div>');IDEE.dialog.info(i),setTimeout((function(){document.querySelector("div.m-api-idee-container div.m-dialog div.m-title").style.backgroundColor="#71a7d3",document.querySelector("div.m-dialog.info div.m-button > button").remove()}),10),IDEE.remote.get("".concat(this.url_,"/api/operations/checkCoordinates?x=").concat(o[0],"&y=").concat(o[1])).then((function(n){if(!0===JSON.parse(n.text).valid){var i="".concat(t.url_,"/api/operations/viewshed?x=").concat(o[0],"&y=").concat(o[1],"&distance=0.1");IDEE.remote.get(i).then((function(n){document.querySelector("div.m-api-idee-container div.m-dialog").remove();var o=t.getImpl().loadGeoJSONLayer(n.text,e.coord);t.getImpl().centerFeatures(o)})).catch((function(e){document.querySelector("div.m-api-idee-container div.m-dialog").remove(),IDEE.dialog.error(l("error_query"))}))}else document.querySelector("div.m-api-idee-container div.m-dialog").remove(),IDEE.dialog.error(l("outbox"),l("warning"))})).catch((function(e){document.querySelector("div.m-api-idee-container div.m-dialog").remove(),IDEE.dialog.error(l("error_query"))}))}},{key:"clear",value:function(){var e=this.facadeMap_.getLayers().filter((function(e){return"Vector"===e.type&&"viewresult"===e.name}));this.facadeMap_.removeLayers(e),this.deactivate()}},{key:"equals",value:function(t){return t instanceof e}}])&&u(n.prototype,o),r&&u(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,r}();const h=JSON.parse('{"Pu":{"name":"ViewShed","description":"Muestra el área visible calculada a partir de un punto con un análisis de visibilidad.","text":"Muestra área visible mediante análisis de visibilidad a partir de un click","version":"2.0.2","date":"12/07/2020","author":"Guadaltel","org":"CNIG","tags":"api-idee,plugin","icon":"./facade/assets/icons/icon.svg"}}');function b(e){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b(e)}function w(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,E(o.key),o)}}function E(e){var t=function(e,t){if("object"!=b(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=b(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==b(t)?t:t+""}function g(e,t,n){return t=O(t),function(e,t){if(t&&("object"==b(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,_()?Reflect.construct(t,n||[],O(e).constructor):t.apply(e,n))}function _(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(_=function(){return!!e})()}function O(e){return O=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},O(e)}function D(e,t){return D=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},D(e,t)}var I=function(){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),(t=g(this,e)).map_=null,t.controls_=[],t.position_=n.position||"TL",t.collapsed_=n.collapsed,void 0===t.collapsed_&&(t.collapsed_=!0),t.collapsible_=n.collapsible,void 0===t.collapsible_&&(t.collapsible_=!0),t.url_=n.url||"https://componentes-desarrollo.idee.es/geoprocess-services",t.metadata_=h.Pu,t.name_="viewshed",t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&D(e,t)}(e,IDEE.Plugin),t=e,o=[{key:"getJSONTranslations",value:function(e){return"en"===e||"es"===e?"en"===e?r:a:IDEE.language.getTranslation(e).viewshed}}],(n=[{key:"addTo",value:function(e){this.controls_.push(new m({url:this.url_})),this.map_=e,this.panel_=new IDEE.ui.Panel("panelViewShed",{className:"m-viewshed-container",collapsed:this.collapsed_,collapsible:this.collapsible_,position:IDEE.ui.position[this.position_],tooltip:l("tooltip"),collapsedButtonClass:"icon-viewshed"}),this.panel_.addControls(this.controls_),e.addPanels(this.panel_);var t=this;this.controls_[0].on(IDEE.evt.ADDED_TO_MAP,(function(){t.fire(IDEE.evt.ADDED_TO_MAP)}))}},{key:"name",get:function(){return"viewshed"}},{key:"position",get:function(){return this.position_}},{key:"getAPIRest",value:function(){return"".concat(this.name_,"=").concat(this.position_)}},{key:"equals",value:function(t){return t instanceof e}},{key:"getMetadata",value:function(){return this.metadata_}},{key:"destroy",value:function(){this.map_.removeControls(this.controls_);var e=[null,null,null];this.map_=e[0],this.controls_=e[1],this.panel_=e[2]}}])&&w(t.prototype,n),o&&w(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,o}();window.IDEE.plugin||(window.IDEE.plugin={}),window.IDEE.control||(window.IDEE.control={}),window.IDEE.impl||(window.IDEE.impl={}),window.IDEE.impl.control||(window.IDEE.impl.control={}),window.IDEE.plugin.ViewShed=I,window.IDEE.control.ViewShedControl=m,window.IDEE.impl.control.ViewShedControl=t()})()})();
//# sourceMappingURL=viewshed-1.0.0.cesium.min.js.map